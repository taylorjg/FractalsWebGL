(()=>{"use strict";var t={905:t=>{var e=0;function n(t,e){var n=e.data;if(Array.isArray(n)&&!(n.length<2)){var o=n[0],r=n[1],a=n[2],i=t._callbacks[o];i&&(delete t._callbacks[o],i(r,a))}}function o(t){var e=this;e._worker=t,e._callbacks={},t.addEventListener("message",(function(t){n(e,t)}))}o.prototype.postMessage=function(t){var o=this,r=e++,a=[r,t];return new Promise((function(t,e){if(o._callbacks[r]=function(n,o){if(n)return e(new Error(n.message));t(o)},void 0!==o._worker.controller){var i=new MessageChannel;i.port1.onmessage=function(t){n(o,t)},o._worker.controller.postMessage(a,[i.port2])}else o._worker.postMessage(a)}))},t.exports=o}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var a=e[o]={exports:{}};return t[o](a,a.exports,n),a.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.u=t=>t+".js",n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var o=e.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&!t;)t=o[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),n.b=document.baseURI||self.location.href,(()=>{var t=n(905),e=n.n(t),o="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});const r=[()=>0,()=>.5,()=>1,t=>t,t=>Math.pow(t,2),t=>Math.pow(t,3),t=>Math.pow(t,4),t=>Math.sqrt(t),t=>Math.sqrt(Math.sqrt(t)),t=>Math.sin(t*Math.PI/2),t=>Math.cos(t*Math.PI/2),t=>Math.abs(t-.5),t=>Math.pow(2*t-1,2),t=>Math.sin(t*Math.PI),t=>Math.abs(Math.cos(t*Math.PI)),t=>Math.sin(2*t*Math.PI),t=>Math.cos(2*t*Math.PI),t=>Math.abs(Math.sin(2*t*Math.PI)),t=>Math.abs(Math.cos(2*t*Math.PI)),t=>Math.abs(Math.sin(4*t*Math.PI)),t=>Math.abs(Math.cos(4*t*Math.PI)),t=>3*t,t=>3*t-1,t=>3*t-2,t=>Math.abs(3*t-1),t=>Math.abs(3*t-2),t=>(3*t-1)/2,t=>(3*t-2)/2,t=>Math.abs((3*t-1)/2),t=>Math.abs((3*t-2)/2),t=>t/.32-.78125,t=>2*t-.84,t=>t<.25?4*t:t<.92?-2*t+1.84:t/.08-11.5,t=>Math.abs(2*t-.5),t=>2*t,t=>2*t-.5,t=>2*t-1],a={jet:{usesFuncs:!1,red:[[0,0,0],[.35,0,0],[.66,1,1],[.89,1,1],[1,.5,.5]],green:[[0,0,0],[.125,0,0],[.375,1,1],[.64,1,1],[.91,0,0],[1,0,0]],blue:[[0,.5,.5],[.11,1,1],[.34,1,1],[.65,0,0],[1,0,0]]},hot:{usesFuncs:!1,red:[[0,.0416,.0416],[.365079,1,1],[1,1,1]],green:[[0,0,0],[.365079,0,0],[.746032,1,1],[1,1,1]],blue:[[0,0,0],[.746032,0,0],[1,1,1]]},gist_stern:{usesFuncs:!1,red:[[0,0,0],[.0547,1,1],[.25,.027,.25],[1,1,1]],green:[[0,0,0],[1,0,0]],blue:[[0,0,0],[.5,1,1],[.735,0,0],[1,0,0]]},gnuplot:{usesFuncs:!0,red:r[7],green:r[5],blue:r[15]},gnuplot2:{usesFuncs:!0,red:r[30],green:r[31],blue:r[32]},afmhot:{usesFuncs:!0,red:r[34],green:r[35],blue:r[36]}},i=t=>t.reduce(((t,e)=>t.concat(e)),[]),s=i(Array(252).fill([1,1,1,1]).concat(Array(4).fill([0,0,0,1]))),c=(t,e,n,o)=>{const r=Array(t);for(let a=0;a<t;a++)r[a]=[e[a],n[a],o[a],1];return r},l=(t,e)=>{let n=e.map((t=>t[0]));const o=e.map((t=>t[1])),r=e.map((t=>t[2]));n=n.map((e=>e*(t-1)));const a=new Array(t).fill(0),i=Array.from(Array(t).keys());let s=u(n,i);s=s.slice(1,s.length-1);const c=Array.from(Array(t-2).keys()).map((t=>(i[t+1]-n[s[t]-1])/(n[s[t]]-n[s[t]-1])));return Array.from(Array(t-2).keys()).forEach((t=>a[t+1]=c[t]*(o[s[t]]-r[s[t]-1])+r[s[t]-1])),a[0]=r[0],a[t-1]=o[o.length-1],a.map(d)},u=(t,e)=>{const n=Array(e.length),o=t.length;for(let r=0;r<e.length;r++){const a=e[r];let i=!1;for(let e=0;e<o;e++)if(a<=t[e]){n[r]=e,i=!0;break}i||(n[r]=o)}return n},m=(t,e)=>h(t,0,1).map(e).map(d),h=(t,e,n)=>{const o=(n-e)/(t-1),r=Array(t);for(let t=0;t<r.length;t++)r[t]=e+t*o;return r[r.length-1]=n,r},d=t=>f(0,1,t),f=(t,e,n)=>n<t?t:n>e?e:n,g=new Worker(new URL(n.p+n.u(415),n.b)),p=new(e())(g);let y,v;const x=(t,e)=>{const n=(t=>{const e=a[t];return e?((t,e)=>{const n=t.usesFuncs?m:l,o=n(e,t.red),r=n(e,t.green),a=n(e,t.blue);return i(c(e,o,r,a))})(e,256):("monochrome"===t||console.error(`ERROR: unknown colour map name, '${t}'.`),s)})(t);return((t,e)=>{const n=v.createTexture();v.activeTexture(v.TEXTURE0+e),v.bindTexture(v.TEXTURE_2D,n),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.NEAREST),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.NEAREST);const o=new Uint8Array(t.map((t=>255*t))),r=t.length/4;v.texImage2D(v.TEXTURE_2D,0,v.RGBA,r,1,0,v.RGBA,v.UNSIGNED_BYTE,o)})(n,e),{name:t,colourMap:n,textureUnit:e}},M=new Map,I=new Map;let w,A,b,k,T,P,E=128,z={},R={},S=!1;const C={fractalSetId:0,juliaConstant:{x:0,y:0},colourMapId:0,regionBottomLeft:{x:-.22,y:-.7},regionTopRight:{x:-.21,y:-.69},maxIterations:128},_={fractalSetId:0,juliaConstant:{x:0,y:0},colourMapId:0,regionBottomLeft:{x:-2.25,y:-1.5},regionTopRight:{x:.75,y:1.5},maxIterations:128};let L=!1,F=0,B=new Map;const N=()=>v instanceof WebGL2RenderingContext,U=(t,e,n)=>{const o=t.createShader(n);if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(o);return console.error(`Failed to compile shader: ${e}`),null}return o},D=(t,e,n)=>{const o=U(v,e,v.VERTEX_SHADER),r=U(v,n,v.FRAGMENT_SHADER),a=v.createProgram();if(v.attachShader(a,o),v.attachShader(a,r),v.linkProgram(a),!v.getProgramParameter(a,v.LINK_STATUS)){const t=v.getProgramInfoLog(a);return void console.error(`Could not initialise shaders: ${t}`)}const i=v.getAttribLocation(a,"aVertexPosition");v.enableVertexAttribArray(i);const s=v.getAttribLocation(a,"aPlotPosition");v.enableVertexAttribArray(s);const c=v.getUniformLocation(a,"uModelViewMatrix"),l=v.getUniformLocation(a,"uColormap"),u=v.getUniformLocation(a,"uJuliaConstant"),m=N()?{uMaxIterations:v.getUniformLocation(a,"uMaxIterations")}:void 0,h=v.createBuffer();return v.bindBuffer(v.ARRAY_BUFFER,h),v.bufferData(v.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),v.STATIC_DRAW),v.vertexAttribPointer(i,2,v.FLOAT,!1,0,0),{name:t,program:a,aVertexPosition:i,aPlotPosition:s,uModelViewMatrix:c,...m,uColormap:l,uJuliaConstant:u,vertexPositionBuffer:h}},X=(t,e,n)=>{Number.isInteger(t)&&(w=t,A=M.get(t)),e&&(b=e),b||(b={x:0,y:0}),Number.isInteger(n)&&(k=n,T=I.get(n)),v.useProgram(A.program);const r=(a=new o(16),o!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a);var a;!function(t,e){t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(r,[1,-1,1]),v.uniformMatrix4fv(A.uModelViewMatrix,!1,r),v.uniform1i(A.uColormap,T.textureUnit),v.uniform2f(A.uJuliaConstant,b.x,b.y),V(),j()},j=()=>{const t=[R.x,R.y,z.x,R.y,R.x,z.y,z.x,z.y],e=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,e),v.bufferData(v.ARRAY_BUFFER,new Float32Array(t),v.STATIC_DRAW),v.vertexAttribPointer(A.aPlotPosition,2,v.FLOAT,!1,0,0),N()&&v.uniform1i(A.uMaxIterations,E),v.drawArrays(v.TRIANGLE_STRIP,0,4),v.deleteBuffer(e)},O=async t=>{nt(t);const e={type:"chooseConfiguration",fractalSetIds:[0,1],colorMapIds:Array.from(I.keys())},n=await p.postMessage(e);setTimeout(O,1e4,n)},q=t=>{const e=(R.x-z.x)/100*t/2,n=(R.y-z.y)/100*t/2;z.x+=e,z.y+=n,R.x-=e,R.y-=n},V=()=>{y.width=y.clientWidth,y.height=y.clientHeight,v.viewport(0,0,y.width,y.height),((t,e)=>{const n=R.x-z.x,o=R.y-z.y;if(t>e){const r=(t/e*o-n)/2;z.x-=r,R.x+=r}if(t<e){const r=(e/t*n-o)/2;z.y-=r,R.y+=r}})(y.width,y.height)},Y=()=>{V(),j()},J=t=>{const e=t.offsetX,n=t.offsetY,{regionMouseX:o,regionMouseY:r}=((t,e)=>{const n=R.x-z.x,o=R.y-z.y;return{regionMouseX:z.x+t*n/y.width,regionMouseY:z.y+e*o/y.height}})(e,n);if(t.shiftKey){const t=R.x-z.x,e=R.y-z.y,n=o-(z.x+t/2),a=r-(z.y+e/2);return z.x+=n,z.y+=a,R.x+=n,R.y+=a,j()}if(t.altKey)switch(w){case 0:return X(1,{x:o,y:r});case 1:return X(0);default:return}S=!0,P={mouseX:e,mouseY:n}},G=t=>{if(!S)return;const e=t.offsetX,n=t.offsetY,o=e-P.mouseX,r=n-P.mouseY,a=R.x-z.x,i=R.y-z.y,s=o*a/y.width,c=r*i/y.height;z.x-=s,z.y-=c,R.x-=s,R.y-=c,j(),P={mouseX:e,mouseY:n}},K=()=>{S=!1},W=()=>{S=!1},H=t=>{if(L)return Q(t);if(L||"b"!==t.key||!t.ctrlKey){if("+"===t.key)return q(50),j();if("-"===t.key)return q(-100),j();if("h"===t.key&&t.ctrlKey)return nt(_);if(("c"===t.key||"C"===t.key)&&t.ctrlKey){const e=Array.from(I.keys()),n=e.length,o=e.indexOf(k),r=e[(o+(t.shiftKey?n-1:1))%n];return X(void 0,void 0,r)}if(N()&&("i"===t.key||"I"===t.key)){const e=16*(t.shiftKey?-1:1);return E+=e,E=Math.min(E,256),E=Math.max(E,16),j()}"r"===t.key||t.key}else L=!0},Q=t=>{if(L=!1,"n"===t.key){const t=et();return Z(t)}if("l"===t.key)return tt()},Z=t=>{const e=$("#bookmarkModal"),n=Number.isInteger(t.id),o=n?"Edit Bookmark":"Create Bookmark";$(".modal-title",e).text(o),$('input[type="submit"]',e).off("click").on("click",(o=>{o.preventDefault(),t.name=$("#name",e).val(),n||(t.id=F++,B.set(t.id,t)),ot(B),e.modal("hide")}));const r=$("img.thumbnail",e),a=$("canvas.thumbnail",e);if(n)a.hide(),r.show(),r[0].src=t.thumbnail;else{r.hide(),a.show();const e=a[0],n=e.getContext("2d"),o=Math.min(y.width,y.height),i=Math.min(y.width,y.height),s=(y.width-o)/2,c=(y.height-i)/2,l=e.width,u=e.height;n.drawImage(y,s,c,o,i,0,0,l,u),t.thumbnail=e.toDataURL("image/jpeg",1)}$("#name",e).val(t.name).focus(),$(".fractal-set",e).text(M.get(t.fractalSetId).name),$(".colour-map",e).text(I.get(t.colourMapId).name),$(".max-iterations",e).text(t.maxIterations),$(".region-bottom-left",e).text(`(${t.regionBottomLeft.x}, ${t.regionBottomLeft.y})`),$(".region-top-right",e).text(`(${t.regionTopRight.x}, ${t.regionTopRight.y})`);const i=$(".julia-constant",e),s=i.closest("div");1===t.fractalSetId?(i.text(`(${t.juliaConstant.x}, ${t.juliaConstant.y})`),s.show()):s.hide(),e.modal()},tt=()=>{const t=$("#manageBookmarksModal"),e=$("tbody",t).empty(),n=(e,n)=>()=>{t.modal("hide"),e(n)},o=t=>nt(t),r=t=>Z(t),a=t=>{B.delete(t.id),ot(B)},i=document.getElementById("bookmark-row-template");B.forEach((t=>{const s=document.importNode(i.content,!0),c=s.querySelector(":nth-child(1) img"),l=s.querySelector(":nth-child(2)"),u=s.querySelector(":nth-child(3) i"),m=s.querySelector(":nth-child(4) i");c.src=t.thumbnail,l.innerText=t.name,c.addEventListener("click",n(o,t)),u.addEventListener("click",n(r,t)),m.addEventListener("click",n(a,t)),e.append(s)})),t.modal()},et=t=>({name:t||`Bookmark${F}`,fractalSetId:w,juliaConstant:{...b},colourMapId:k,regionBottomLeft:{...z},regionTopRight:{...R},maxIterations:E}),nt=t=>{z.x=t.regionBottomLeft.x,z.y=t.regionBottomLeft.y,R.x=t.regionTopRight.x,R.y=t.regionTopRight.y,E=t.maxIterations,X(t.fractalSetId,t.juliaConstant,t.colourMapId)},ot=t=>{localStorage.bookmarks=JSON.stringify(Array.from(t.entries()))};(async t=>{if(y=document.getElementById("canvas"),(t=>{v=t.getContext("webgl"),v||console.error("Failed to initialise WebGL")})(y),(()=>{const t=N()?"#version 300 es\nprecision highp float;\n\nin vec2 aVertexPosition;\nin vec2 aPlotPosition;\nuniform mat4 uModelViewMatrix;\nout vec2 vPosition;\n\nvoid main(void) {\n  gl_Position = uModelViewMatrix * vec4(aVertexPosition, 0, 1);\n  vPosition = aPlotPosition;\n}\n":"precision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aPlotPosition;\nuniform mat4 uModelViewMatrix;\nvarying vec2 vPosition;\n\nvoid main(void) {\n  gl_Position = uModelViewMatrix * vec4(aVertexPosition, 0, 1);\n  vPosition = aPlotPosition;\n}\n",e=N()?"#version 300 es\nprecision highp float;\n\n// Can't use @import anymore - I think it was a feature of the following\n// package which I am no longer using:\n// https://www.npmjs.com/package/webpack-glsl-loader\n// @import ./common;\n\nvec4 loop(int maxIterations, sampler2D colormap, vec2 z, vec2 c) {\n  int iteration = 0;\n  while (iteration < maxIterations) {\n    if (dot(z, z) >= 4.0) break;\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n    iteration++;\n  }\n  int s = 255 * iteration / maxIterations;\n  int t = 0;\n  ivec2 coord = ivec2(s, t);\n  int lod = 0;\n  return texelFetch(colormap, coord, lod);\n}\n\nuniform int uMaxIterations;\nuniform sampler2D uColormap;\nin vec2 vPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 z;\n  vec2 c = vPosition;\n  fragColor = loop(uMaxIterations, uColormap, z, c);\n}\n":"precision highp float;\n\n// Can't use @import anymore - I think it was a feature of the following\n// package which I am no longer using:\n// https://www.npmjs.com/package/webpack-glsl-loader\n// @import ./common;\n\n// Same value as INITIAL_ITERATIONS in constants.js\nconst int MAX_ITERATIONS = 128;\n\nvec4 loop(sampler2D colormap, vec2 z, vec2 c) {\n  int iteration = MAX_ITERATIONS;\n  for (int i = 0; i < MAX_ITERATIONS; i++) {\n    if (dot(z, z) >= 4.0) {\n      iteration = i;\n      break;\n    }\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n  }\n  float s = float(iteration) / float(MAX_ITERATIONS + 1);\n  float t = 0.0;\n  vec2 coord = vec2(s, t);\n  return texture2D(colormap, coord);\n}\n\nuniform sampler2D uColormap;\nvarying vec2 vPosition;\n\nvoid main(void) {\n  vec2 z;\n  vec2 c = vPosition;\n  gl_FragColor = loop(uColormap, z, c);\n}\n",n=N()?"#version 300 es\nprecision highp float;\n\n// Can't use @import anymore - I think it was a feature of the following\n// package which I am no longer using:\n// https://www.npmjs.com/package/webpack-glsl-loader\n// @import ./common;\n\nvec4 loop(int maxIterations, sampler2D colormap, vec2 z, vec2 c) {\n  int iteration = 0;\n  while (iteration < maxIterations) {\n    if (dot(z, z) >= 4.0) break;\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n    iteration++;\n  }\n  int s = 255 * iteration / maxIterations;\n  int t = 0;\n  ivec2 coord = ivec2(s, t);\n  int lod = 0;\n  return texelFetch(colormap, coord, lod);\n}\n\nuniform int uMaxIterations;\nuniform sampler2D uColormap;\nuniform vec2 uJuliaConstant;\nin vec2 vPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 z = vPosition;\n  vec2 c = uJuliaConstant;\n  fragColor = loop(uMaxIterations, uColormap, z, c);\n}\n":"precision highp float;\n\n// Can't use @import anymore - I think it was a feature of the following\n// package which I am no longer using:\n// https://www.npmjs.com/package/webpack-glsl-loader\n// @import ./common;\n\n// Same value as INITIAL_ITERATIONS in constants.js\nconst int MAX_ITERATIONS = 128;\n\nvec4 loop(sampler2D colormap, vec2 z, vec2 c) {\n  int iteration = MAX_ITERATIONS;\n  for (int i = 0; i < MAX_ITERATIONS; i++) {\n    if (dot(z, z) >= 4.0) {\n      iteration = i;\n      break;\n    }\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n  }\n  float s = float(iteration) / float(MAX_ITERATIONS + 1);\n  float t = 0.0;\n  vec2 coord = vec2(s, t);\n  return texture2D(colormap, coord);\n}\n\nuniform sampler2D uColormap;\nuniform vec2 uJuliaConstant;\nvarying vec2 vPosition;\n\nvoid main(void) {\n  vec2 z = vPosition;\n  vec2 c = uJuliaConstant;\n  gl_FragColor = loop(uColormap, z, c);\n}\n",o=D("Mandelbrot",t,e),r=D("Julia",t,n);M.set(0,o),M.set(1,r)})(),Array.from(Object.keys(a)).forEach(((t,e)=>{I.set(e,x(t,e))})),window.addEventListener("resize",Y),t)y.addEventListener("mousedown",J),y.addEventListener("mousemove",G),y.addEventListener("mouseup",K),y.addEventListener("mouseleave",W),document.addEventListener("keydown",H),B=new Map(JSON.parse(localStorage.bookmarks||"[]")),F=B.size?Math.max(...B.keys())+1:0,nt(C);else{O(C);const t=()=>{(t=>{const e=(R.x-z.x)/100*t,n=(R.y-z.y)/100*t;z.x-=e,z.y-=n,R.x-=e,R.y-=n})(.01),q(.01),j(),requestAnimationFrame(t)};t()}})("manual"===new URL(document.location).searchParams.get("mode"))})()})();
//# sourceMappingURL=bundle.js.map