(()=>{var e={440:e=>{e.exports={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],alpha:[{index:0,rgb:[255,255,255,0]},{index:1,rgb:[255,255,255,1]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]}},800:(e,n,t)=>{"use strict";var r=t(440),i=t(450);function o(e){return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function a(e){for(var n,t="#",r=0;r<3;++r)t+=("00"+(n=(n=e[r]).toString(16))).substr(n.length);return t}function d(e){return"rgba("+e.join(",")+")"}e.exports=function(e){var n,t,g,s,x,b,c,u,l,m;if(e||(e={}),u=(e.nshades||72)-1,c=e.format||"hex",(b=e.colormap)||(b="jet"),"string"==typeof b){if(b=b.toLowerCase(),!r[b])throw Error(b+" not a supported colorscale");x=r[b]}else{if(!Array.isArray(b))throw Error("unsupported colormap option",b);x=b.slice()}if(x.length>u+1)throw new Error(b+" map requires nshades to be at least size "+x.length);l=Array.isArray(e.alpha)?2!==e.alpha.length?[1,1]:e.alpha.slice():"number"==typeof e.alpha?[e.alpha,e.alpha]:[1,1],n=x.map((function(e){return Math.round(e.index*u)})),l[0]=Math.min(Math.max(l[0],0),1),l[1]=Math.min(Math.max(l[1],0),1);var h=x.map((function(e,n){var t=x[n].index,r=x[n].rgb.slice();return 4===r.length&&r[3]>=0&&r[3]<=1||(r[3]=l[0]+(l[1]-l[0])*t),r})),f=[];for(m=0;m<n.length-1;++m){s=n[m+1]-n[m],t=h[m],g=h[m+1];for(var p=0;p<s;p++){var y=p/s;f.push([Math.round(i(t[0],g[0],y)),Math.round(i(t[1],g[1],y)),Math.round(i(t[2],g[2],y)),i(t[3],g[3],y)])}}return f.push(x[x.length-1].rgb.concat(l[1])),"hex"===c?f=f.map(a):"rgbaString"===c?f=f.map(d):"float"===c&&(f=f.map(o)),f}},450:e=>{e.exports=function(e,n,t){return e*(1-t)+n*t}},905:e=>{"use strict";var n=0;function t(e,n){var t=n.data;if(Array.isArray(t)&&!(t.length<2)){var r=t[0],i=t[1],o=t[2],a=e._callbacks[r];a&&(delete e._callbacks[r],a(i,o))}}function r(e){var n=this;n._worker=e,n._callbacks={},e.addEventListener("message",(function(e){t(n,e)}))}r.prototype.postMessage=function(e){var r=this,i=n++,o=[i,e];return new Promise((function(e,n){if(r._callbacks[i]=function(t,r){if(t)return n(new Error(t.message));e(r)},void 0!==r._worker.controller){var a=new MessageChannel;a.port1.onmessage=function(e){t(r,e)},r._worker.controller.postMessage(o,[a.port2])}else r._worker.postMessage(o)}))},e.exports=r}},n={};function t(r){var i=n[r];if(void 0!==i)return i.exports;var o=n[r]={exports:{}};return e[r](o,o.exports,t),o.exports}t.m=e,t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},t.u=e=>e+".js",t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var n=t.g.document;if(!e&&n&&(n.currentScript&&(e=n.currentScript.src),!e)){var r=n.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&!e;)e=r[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=document.baseURI||self.location.href,(()=>{"use strict";var e=t(800),n=t.n(e),r="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)});var i=t(905),o=t.n(i);const a=["jet","hsv","hot","cool","warm","spring","summer","autumn","winter","bone","copper","greys","YIOrRd","bluered","RdBu","picnic","rainbow","portland","blackbody","earth","electric","viridis","inferno","magma","plasma","rainbow-soft","bathymetry","cdom","chlorophyll","density","freesurface-blue","freesurface-red"],d={fractalSetId:0,juliaConstant:{x:0,y:0},colourMapId:0,regionBottomLeft:{x:-.22,y:-.7},regionTopRight:{x:-.21,y:-.69},maxIterations:128},g={fractalSetId:0,juliaConstant:{x:0,y:0},colourMapId:0,regionBottomLeft:{x:-2.25,y:-1.5},regionTopRight:{x:.75,y:1.5},maxIterations:128},s=64,x=(e,n)=>Math.random()*(n-e)+e,b=()=>x(-.1,.1),c=new Worker(new URL(t.p+t.u(653),t.b)),u=new(o())(c);let l,m,h,f,p,y,v=!1;const R=new Map,M=new Map;let E,T,_,I,k,w=128;const A=new class{constructor(){this._bottomLeft={x:0,y:0},this._topRight={x:0,y:0}}get top(){return this._topRight.y}get bottom(){return this._bottomLeft.y}get left(){return this._bottomLeft.x}get right(){return this._topRight.x}get topLeft(){return{x:this.left,y:this.top}}get topRight(){return{...this._topRight}}get bottomLeft(){return{...this._bottomLeft}}get bottomRight(){return{x:this.right,y:this.bottom}}get width(){return this._topRight.x-this._bottomLeft.x}get height(){return this.topRight.y-this._bottomLeft.y}get centreX(){return this.left+this.width/2}get centreY(){return this.bottom+this.height/2}set(e,n){this._bottomLeft.x=e.x,this._bottomLeft.y=e.y,this._topRight.x=n.x,this._topRight.y=n.y}adjustAspectRatio(e,n){if(e>=n){const t=(e/n*this.height-this.width)/2;this._bottomLeft.x-=t,this._topRight.x+=t}if(e<n){const t=(n/e*this.width-this.height)/2;this._bottomLeft.y-=t,this._topRight.y+=t}}mouseToRegion(e,n,t){const r=n*(this.width/e.width),i=t*(this.height/e.height);return{regionMouseX:this.left+r,regionMouseY:this.bottom+i}}drag(e,n,t){const r=n*(this.width/e.width),i=t*(this.height/e.height);this._bottomLeft.x-=r,this._bottomLeft.y-=i,this._topRight.x-=r,this._topRight.y-=i}recentre(e,n){const t=e-this.centreX,r=n-this.centreY;this._bottomLeft.x+=t,this._bottomLeft.y+=r,this._topRight.x+=t,this._topRight.y+=r}panX(e){const n=this.width/100*e;this._bottomLeft.x-=n,this._topRight.x-=n}panY(e){const n=this.height/100*e;this._bottomLeft.y-=n,this._topRight.y-=n}zoom(e){const n=this.width/100*e/2,t=this.height/100*e/2;this._bottomLeft.x+=n,this._bottomLeft.y+=t,this._topRight.x-=n,this._topRight.y-=t}};let S,C,L,B=0,P=0,z=0,F=!1,O=!1,D=!1,U=new Map,X=0,N=!1,Y=!1;const j=()=>{N=!0},V=()=>{N=!1},G=e=>{localStorage.bookmarks=JSON.stringify(Array.from(e.entries()))},q=e=>{e.id=X++,U.set(e.id,e),G(U)},W=e=>{U.set(e.id,e),G(U)},J=e=>{U.delete(e.id),G(U)},H=e=>({name:e||`Bookmark${X}`,fractalSetId:E,juliaConstant:{..._},colourMapId:I,regionBottomLeft:{...A.bottomLeft},regionTopRight:{...A.topRight},maxIterations:w}),K=e=>{re(e)},Z="webgl",Q="webgl2",ee=["experimental-webgl",Z,Q],ne=(e,n,t,r)=>{const i=((e,n)=>{if(n?.length>0){const t=e.indexOf("// INSERT-COMMON-CODE-HERE\n");if(t>=0){const r=t+27,i=n.join("\n");return e.substring(0,r)+i+e.substring(r)}}return e})(n,r),o=e.createShader(t);if(e.shaderSource(o,i),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){const n=e.getShaderInfoLog(o);return console.error(`Failed to compile shader: ${n}`),null}return o},te=(e,n,t)=>{const r=v?["const int COLOUR_MAP_SIZE = 256;\n\nvec4 loop(int maxIterations, sampler2D colourMap, vec2 z, vec2 c) {\n  int iteration = 0;\n  while (iteration < maxIterations) {\n    if (dot(z, z) >= 4.0) break;\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n    iteration++;\n  }\n\n  int s = (COLOUR_MAP_SIZE - 1) * iteration / maxIterations;\n  int t = 0;\n  ivec2 textureCoords = ivec2(s, t);\n  int levelOfDetail = 0;\n  return texelFetch(colourMap, textureCoords, levelOfDetail);\n}\n"]:["// Same value as INITIAL_ITERATIONS in constants.js\nconst int MAX_ITERATIONS = 128;\n\nconst int COLOUR_MAP_SIZE = 256;\n\nvec4 loop(sampler2D colourMap, vec2 z, vec2 c) {\n  int iteration = MAX_ITERATIONS;\n  for (int i = 0; i < MAX_ITERATIONS; i++) {\n    if (dot(z, z) >= 4.0) {\n      iteration = i;\n      break;\n    }\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n  }\n\n  for (int i = 0; i < 2; i++) {\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n    iteration++;\n  }\n\n  // http://linas.org/art-gallery/escape/escape.html\n  float smoothedIteration = float(iteration) - log(log(length(z))) / log(2.0);\n\n  float s = smoothedIteration / float(MAX_ITERATIONS);\n  float t = 0.5;\n  vec2 textureCoords = vec2(s, t);\n  return texture2D(colourMap, textureCoords);\n}\n"],i=ne(p,n,p.VERTEX_SHADER),o=ne(p,t,p.FRAGMENT_SHADER,r),a=p.createProgram();if(p.attachShader(a,i),p.attachShader(a,o),p.linkProgram(a),!p.getProgramParameter(a,p.LINK_STATUS)){const e=p.getProgramInfoLog(a);return void console.error(`Could not initialise shaders: ${e}`)}const d=p.getAttribLocation(a,"aVertexPosition");p.enableVertexAttribArray(d);const g=p.getAttribLocation(a,"aRegionPosition");p.enableVertexAttribArray(g);const s=p.createBuffer();p.bindBuffer(p.ARRAY_BUFFER,s),p.bufferData(p.ARRAY_BUFFER,32,p.DYNAMIC_DRAW);const x=p.getUniformLocation(a,"uModelViewMatrix"),b=p.getUniformLocation(a,"uColourMap"),c=p.getUniformLocation(a,"uJuliaConstant"),u=v?{uMaxIterations:p.getUniformLocation(a,"uMaxIterations")}:void 0,l=new Float32Array([1,1,-1,1,1,-1,-1,-1]),m=p.createBuffer();return p.bindBuffer(p.ARRAY_BUFFER,m),p.bufferData(p.ARRAY_BUFFER,l,p.STATIC_DRAW),p.vertexAttribPointer(d,2,p.FLOAT,!1,0,0),{name:e,program:a,aVertexPosition:d,aRegionPosition:g,uModelViewMatrix:x,...u,uColourMap:b,uJuliaConstant:c,vertexPositionBuffer:m,regionPositionBuffer:s}},re=({fractalSetId:e,juliaConstant:n,colourMapId:t,maxIterations:i,regionBottomLeft:o,regionTopRight:a})=>{o&&a&&ie((()=>{A.set(o,a)})),Number.isInteger(e)&&(E=e,T=R.get(e)),n&&(_=n),Number.isInteger(t)&&(I=t,k=M.get(t)),v&&Number.isInteger(i)&&(w=i),p.useProgram(T.program);const d=function(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}((g=new r(16),r!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0),g[0]=1,g[5]=1,g[10]=1,g[15]=1,g),[1,-1,1]);var g;p.uniformMatrix4fv(T.uModelViewMatrix,!1,d),p.uniform1i(T.uColourMap,k.textureUnit),p.uniform2f(T.uJuliaConstant,_.x,_.y),v&&p.uniform1i(T.uMaxIterations,w)},ie=e=>{e(),(()=>{if(!T)return;const{regionPositionBuffer:e,aRegionPosition:n}=T,t=new Float32Array([A.topRight.x,A.topRight.y,A.topLeft.x,A.topLeft.y,A.bottomRight.x,A.bottomRight.y,A.bottomLeft.x,A.bottomLeft.y]);p.bindBuffer(p.ARRAY_BUFFER,e),p.bufferData(p.ARRAY_BUFFER,t,p.DYNAMIC_DRAW),p.vertexAttribPointer(n,2,p.FLOAT,!1,0,0),p.bindBuffer(p.ARRAY_BUFFER,null)})()},oe=()=>{p.drawArrays(p.TRIANGLE_STRIP,0,4),l.manualMode&&he()},ae=async e=>{K(e),de(),he(e),B=e.panSpeedX??b(),P=e.panSpeedY??b(),z=e.zoomSpeed??x(.01,.1);const n={type:"chooseConfiguration",fractalSetIds:Array.from(R.keys()),colourMapIds:Array.from(M.keys())},t=await u.postMessage(n);setTimeout(ae,1e4,t)},de=(e,n)=>{const t=e??m.clientWidth,r=n??m.clientHeight;e||n||(m.width=t,m.height=r,h.setSize(t,r)),p.viewport(0,0,t,r),ie((()=>{A.adjustAspectRatio(t,r)}))},ge=()=>{de(),oe()},se=e=>{const n=e.offsetX,t=e.offsetY,{regionMouseX:r,regionMouseY:i}=A.mouseToRegion(m,n,t);if(e.metaKey)return O=!0,S={mouseX:n,mouseY:t},void(C={mouseX:n,mouseY:t});if(e.shiftKey)return ie((()=>{A.recentre(r,i)})),oe();if(e.altKey)switch(E){case 0:return re({fractalSetId:1,juliaConstant:{x:r,y:i}}),void oe();case 1:return re({fractalSetId:0}),void oe();default:return}F=!0,L={mouseX:n,mouseY:t}},xe=e=>{const n=e.offsetX,t=e.offsetY;return F?(ie((()=>{const e=n-L.mouseX,r=t-L.mouseY;A.drag(m,e,r)})),oe(),void(L={mouseX:n,mouseY:t})):O?(C={mouseX:n,mouseY:t},void h.drawSelectionRegion(S.mouseX,S.mouseY,C.mouseX,C.mouseY)):void 0},be=()=>{if(F=!1,O){const e=S,n=C,t=Math.max(e.mouseY,n.mouseY),r=Math.min(e.mouseY,n.mouseY),i=Math.min(e.mouseX,n.mouseX),o=Math.max(e.mouseX,n.mouseX),a=A.mouseToRegion(m,i,r),d=A.mouseToRegion(m,o,t),g={x:a.regionMouseX,y:a.regionMouseY},s={x:d.regionMouseX,y:d.regionMouseY};ie((()=>{A.set(g,s)})),de(),oe(),h.clearSelectionRegion(),O=!1}},ce=()=>{F&&(F=!1),O&&(h.clearSelectionRegion(),S=void 0,C=void 0,O=!1)},ue=e=>{if(!N){if(D)return fe(e);if(D||"b"!==e.key||!e.ctrlKey){if("+"===e.key)return ie((()=>{A.zoom(50)})),void oe();if("-"===e.key)return ie((()=>{A.zoom(-100)})),void oe();if("h"===e.key&&e.ctrlKey)return K(g),de(),void oe();if(("c"===e.key||"C"===e.key)&&e.ctrlKey){const n=Array.from(M.keys()),t=n.length,r=n.indexOf(I),i=n[(r+(e.shiftKey?t-1:1))%t];return re({colourMapId:i}),void oe()}if(v&&("i"===e.key||"I"===e.key)){const t=16*(e.shiftKey?-1:1);return 16,4096,n=w+t,w=Math.max(16,Math.min(4096,n)),re({maxIterations:w}),void oe()}var n;"v"!==e.key&&"V"!==e.key||(Y?le():me())}else D=!0}},le=()=>{h.hideConfigurationSummary(),Y=!1},me=()=>{const e=H();h.showConfigurationSummary(e),Y=!0},he=()=>{const e=H();h.updateConfigurationSummary(e)},fe=e=>{if(D=!1,"n"===e.key){const e=H();return y.presentBookmarkModal(e)}if("l"===e.key)return y.presentManageBookmarksModal(U)},pe=new URL(document.location);(async e=>{if(l=e,m=document.getElementById("canvas"),(e=>{const n=n=>{try{p=e.getContext(n),p||console.log(`Failed to initialise WebGL (contextType: ${n})`)}catch(e){alert(`Exception trying to initialise WebGL (contextType: ${n})\n${e.message}`)}const t=Boolean(p);return t&&n===Q&&(v=!0),t},t=ee.includes(l.contextType)?l.contextType:Q;n(t)||t!==Z&&n(Z)})(m),(()=>{const e=v?"#version 300 es\nprecision highp float;\n\nin vec2 aVertexPosition;\nin vec2 aRegionPosition;\nuniform mat4 uModelViewMatrix;\nout vec2 vRegionPosition;\n\nvoid main(void) {\n  gl_Position = uModelViewMatrix * vec4(aVertexPosition, 0, 1);\n  vRegionPosition = aRegionPosition;\n}\n":"precision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aRegionPosition;\nuniform mat4 uModelViewMatrix;\nvarying vec2 vRegionPosition;\n\nvoid main(void) {\n  gl_Position = uModelViewMatrix * vec4(aVertexPosition, 0, 1);\n  vRegionPosition = aRegionPosition;\n}\n",n=v?"#version 300 es\nprecision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform int uMaxIterations;\nuniform sampler2D uColourMap;\nuniform vec2 uJuliaConstant;\nin vec2 vRegionPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 z = vRegionPosition;\n  vec2 c = uJuliaConstant;\n  fragColor = loop(uMaxIterations, uColourMap, z, c);\n}\n":"precision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform sampler2D uColourMap;\nuniform vec2 uJuliaConstant;\nvarying vec2 vRegionPosition;\n\nvoid main(void) {\n  vec2 z = vRegionPosition;\n  vec2 c = uJuliaConstant;\n  gl_FragColor = loop(uColourMap, z, c);\n}\n",t=te("Mandelbrot",e,v?"#version 300 es\nprecision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform int uMaxIterations;\nuniform sampler2D uColourMap;\nin vec2 vRegionPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 z;\n  vec2 c = vRegionPosition;\n  fragColor = loop(uMaxIterations, uColourMap, z, c);\n}\n":"precision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform sampler2D uColourMap;\nvarying vec2 vRegionPosition;\n\nvoid main(void) {\n  vec2 z;\n  vec2 c = vRegionPosition;\n  gl_FragColor = loop(uColourMap, z, c);\n}\n"),r=te("Julia",e,n);R.set(0,t),R.set(1,r)})(),a.forEach(((e,t)=>{M.set(t,((e,t)=>{const r=n()({colormap:e,nshades:256,format:"float"}).flat();return((e,n)=>{const t=p.createTexture();p.activeTexture(p.TEXTURE0+n),p.bindTexture(p.TEXTURE_2D,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const r=new Uint8Array(e.map((e=>255*e))),i=e.length/4;p.texImage2D(p.TEXTURE_2D,0,p.RGBA,i,1,0,p.RGBA,p.UNSIGNED_BYTE,r)})(r,t),{name:e,colourMap:r,textureUnit:t}})(e,t))})),h=(({fractalSets:e,colourMaps:n})=>{const t=document.getElementById("canvasOverlay"),r=t.getContext("2d"),i=document.getElementById("divOverlay"),o=document.getElementById("configurationSummary");let a,d=!1;const g=()=>{r.clearRect(0,0,t.width,t.height)},s=({x:e,y:n})=>`(${e}, ${n})`,x=t=>{const r=1===t.fractalSetId?s(t.juliaConstant):"",i=`${s(t.regionBottomLeft)}, ${s(t.regionTopRight)}`,a=[e.get(t.fractalSetId)?.name??"unknown",r,i,n.get(t.colourMapId)?.name??"unknown",t.maxIterations];o.innerText=a.filter(Boolean).join(" | ")},b=()=>{o.style.display="block"},c=()=>{o.style.display="none"},u=()=>{clearTimeout(a),a=void 0};return{setSize:(e,n)=>{t.width=e,t.height=n,i.width=e,i.height=n},drawSelectionRegion:(e,n,t,i)=>{g();const o=Math.max(n,i),a=Math.min(n,i),d=Math.min(e,t),s=Math.max(e,t)-d,x=o-a;r.lineWidth=2,r.strokeStyle="#FFFFFF80",r.strokeRect(d,a,s,x)},clearSelectionRegion:g,showConfigurationSummary:e=>{x(e),b(),u(),d=!0},hideConfigurationSummary:()=>{c(),u(),d=!1},updateConfigurationSummary:e=>{x(e),d||(b(),u(),a=setTimeout((()=>{c(),a=void 0}),5e3))}}})({fractalSets:R,colourMaps:M}),f=(({gl:e,createBookmark:n,switchToBookmark:t,setCanvasAndViewportSize:r,render:i})=>({renderThumbnail:(o,a)=>{const d=e.createTexture();e.bindTexture(e.TEXTURE_2D,d),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,o,o,0,e.RGBA,e.UNSIGNED_BYTE,null);const g=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,g),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,d,0);const s=n("saved-configuration");t(a),r(o,o),i();const x=new Uint8ClampedArray(o*o*4);return e.readPixels(0,0,o,o,e.RGBA,e.UNSIGNED_BYTE,x),t(s),r(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(g),e.bindTexture(e.TEXTURE_2D,null),e.deleteTexture(d),x}}))({gl:p,createBookmark:H,switchToBookmark:K,setCanvasAndViewportSize:de,render:oe}),y=(({isWebGL2:e,renderThumbnail:n,addBookmark:t,updateBookmark:r,deleteBookmark:i,switchToBookmark:o,fractalSets:a,colourMaps:d,onModalOpen:g,onModalClose:x})=>{const b=(e,n,t)=>{n.width=t,n.height=t;const r=n.getContext("2d"),i=new ImageData(e,t,t);r.putImageData(i,0,0),r.scale(1,-1),r.translate(0,-t),r.drawImage(n,0,0)},c=i=>{console.log("[presentBookmarkModal]","bookmark:",i);const o=$("#bookmarkModal").on("show.bs.modal",g).on("hide.bs.modal",x),c=Number.isInteger(i.id),u=c?"Edit Bookmark":"Create Bookmark";$(".modal-title",o).text(u),$('input[type="submit"]',o).off("click").on("click",(e=>{e.preventDefault(),i.name=$("#name",o).val(),c?r(i):t(i),o.modal("hide")}));const l=$("#thumbnail-canvas",o).get(0),m=n(s,i);b(m,l,s),$("#name",o).val(i.name).focus(),$(".fractal-set",o).text(a.get(i.fractalSetId).name);const h=$("#colour-map-select",o).empty();for(const[e,n]of d){const t=e===i.colourMapId?"selected":"";h.append(`<option value="${e}" ${t}>${n.name}</option>`)}h.on("change",(e=>{i.colourMapId=Number(e.target.value);const t=n(s,i);b(t,l,s)}));const f=$("#max-iterations",o);f.text(i.maxIterations);const p=$("#max-iterations-range",o);e?(p.attr("min",16).attr("max",4096).attr("step",16).val(i.maxIterations),p.on("input",(e=>{i.maxIterations=Number(e.target.value),f.text(i.maxIterations);const t=n(s,i);b(t,l,s)}))):p.hide(),$(".region-bottom-left",o).text(`(${i.regionBottomLeft.x}, ${i.regionBottomLeft.y})`),$(".region-top-right",o).text(`(${i.regionTopRight.x}, ${i.regionTopRight.y})`);const y=$(".julia-constant",o),v=y.closest("div");1===i.fractalSetId?(y.text(`(${i.juliaConstant.x}, ${i.juliaConstant.y})`),v.show()):v.hide(),o.modal()};return{presentBookmarkModal:c,presentManageBookmarksModal:e=>{console.log("[presentManageBookmarksModal]","bookmarks:",e);const t=$("#manageBookmarksModal").on("show.bs.modal",g).on("hide.bs.modal",x),r=$("tbody",t).empty(),a=(e,n)=>()=>{t.modal("hide"),e(n)},d=e=>o(e),u=e=>{const n={...e};c(n)},l=e=>{i(e)},m=document.getElementById("bookmark-row-template");e.forEach((e=>{const t=document.importNode(m.content,!0),i=t.querySelector(":nth-child(2)"),o=t.querySelector(":nth-child(3) i"),g=t.querySelector(":nth-child(4) i"),x=t.querySelector(":nth-child(1) canvas"),c=n(s,e);b(c,x,s),i.innerText=e.name,x.addEventListener("click",a(d,e)),o.addEventListener("click",a(u,e)),g.addEventListener("click",a(l,e)),r.append(t)})),t.modal()}}})({isWebGL2:v,renderThumbnail:f.renderThumbnail,addBookmark:q,updateBookmark:W,deleteBookmark:J,switchToBookmark:e=>{K(e),de(),oe()},fractalSets:R,colourMaps:M,onModalOpen:j,onModalClose:V}),window.addEventListener("resize",ge),l.manualMode)m.addEventListener("mousedown",se),m.addEventListener("mousemove",xe),m.addEventListener("mouseup",be),m.addEventListener("mouseleave",ce),document.addEventListener("keydown",ue),(e=>{const n=JSON.parse(localStorage.bookmarks||"[]");for(const[t,r]of n){const{thumbnail:n,...i}=r;e.set(t,i)}})(U),X=U.size?Math.max(...U.keys())+1:0,K(d),de(),oe();else{ae(d);const e=()=>{ie((()=>{A.panX(B),A.panY(P),A.zoom(z)})),oe(),requestAnimationFrame(e)};e()}})({manualMode:"manual"===pe.searchParams.get("mode"),contextType:pe.searchParams.get("contextType")})})()})();
//# sourceMappingURL=bundle.js.map