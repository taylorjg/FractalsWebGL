(()=>{var t={440:t=>{t.exports={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],alpha:[{index:0,rgb:[255,255,255,0]},{index:1,rgb:[255,255,255,1]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]}},800:(t,e,n)=>{"use strict";var i=n(440),o=n(450);function r(t){return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function s(t){for(var e,n="#",i=0;i<3;++i)n+=("00"+(e=(e=t[i]).toString(16))).substr(e.length);return n}function a(t){return"rgba("+t.join(",")+")"}t.exports=function(t){var e,n,c,d,l,h,u,g,m,p;if(t||(t={}),g=(t.nshades||72)-1,u=t.format||"hex",(h=t.colormap)||(h="jet"),"string"==typeof h){if(h=h.toLowerCase(),!i[h])throw Error(h+" not a supported colorscale");l=i[h]}else{if(!Array.isArray(h))throw Error("unsupported colormap option",h);l=h.slice()}if(l.length>g+1)throw new Error(h+" map requires nshades to be at least size "+l.length);m=Array.isArray(t.alpha)?2!==t.alpha.length?[1,1]:t.alpha.slice():"number"==typeof t.alpha?[t.alpha,t.alpha]:[1,1],e=l.map((function(t){return Math.round(t.index*g)})),m[0]=Math.min(Math.max(m[0],0),1),m[1]=Math.min(Math.max(m[1],0),1);var f=l.map((function(t,e){var n=l[e].index,i=l[e].rgb.slice();return 4===i.length&&i[3]>=0&&i[3]<=1||(i[3]=m[0]+(m[1]-m[0])*n),i})),b=[];for(p=0;p<e.length-1;++p){d=e[p+1]-e[p],n=f[p],c=f[p+1];for(var x=0;x<d;x++){var v=x/d;b.push([Math.round(o(n[0],c[0],v)),Math.round(o(n[1],c[1],v)),Math.round(o(n[2],c[2],v)),o(n[3],c[3],v)])}}return b.push(l[l.length-1].rgb.concat(m[1])),"hex"===u?b=b.map(s):"rgbaString"===u?b=b.map(a):"float"===u&&(b=b.map(r)),b}},450:t=>{t.exports=function(t,e,n){return t*(1-n)+e*n}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=n(800),e=n.n(t),i="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});const o={toVector:(t,e)=>(void 0===t&&(t=e),Array.isArray(t)?t:[t,t]),add:(t,e)=>[t[0]+e[0],t[1]+e[1]],sub:(t,e)=>[t[0]-e[0],t[1]-e[1]],addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function r(t,e,n){return 0===e||Math.abs(e)===1/0?Math.pow(t,5*n):t*e*n/(e+n*t)}function s(t,e,n,i=.15){return 0===i?function(t,e,n){return Math.max(e,Math.min(t,n))}(t,e,n):t<e?-r(e-t,n-e,i)+e:t>n?+r(t-n,n-e,i)+n:t}function a(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const l={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function h(t){return t?t[0].toUpperCase()+t.slice(1):""}const u=["enter","leave"];const g=["gotpointercapture","lostpointercapture"];function m(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const i=g.includes(e)?"capturecapture":"capture",o=!!~e.indexOf(i);return o&&(e=e.replace("capture","")),{device:e,capture:o,passive:n}}function p(t){return"touches"in t}function f(t){return p(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function b(t){return p(t)?function(t){return"touchend"===t.type||"touchcancel"===t.type?t.changedTouches:t.targetTouches}(t)[0]:t}function x(t,e){try{const n=e.clientX-t.clientX,i=e.clientY-t.clientY,o=(e.clientX+t.clientX)/2,r=(e.clientY+t.clientY)/2,s=Math.hypot(n,i);return{angle:-180*Math.atan2(n,i)/Math.PI,distance:s,origin:[o,r]}}catch(t){}return null}function v(t,e){const[n,i]=Array.from(t.touches).filter((t=>e.includes(t.identifier)));return x(n,i)}function y(t){const e=b(t);return p(t)?e.identifier:e.pointerId}function _(t){const e=b(t);return[e.clientX,e.clientY]}function w(t){let{deltaX:e,deltaY:n,deltaMode:i}=t;return 1===i?(e*=40,n*=40):2===i&&(e*=800,n*=800),[e,n]}function M(t,...e){return"function"==typeof t?t(...e):t}function S(){}function T(...t){return 0===t.length?S:1===t.length?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function E(t,e){return Object.assign({},e,t||{})}class I{constructor(t,e,n){this.ctrl=t,this.args=e,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:e,ingKey:n,args:i}=this;e[n]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=i,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const e=this.state,n=this.config;e._active||(this.reset(),this.computeInitial(),e._active=!0,e.target=t.target,e.currentTarget=t.currentTarget,e.lastOffset=n.from?M(n.from,e):e.offset,e.offset=e.lastOffset,e.startTime=e.timeStamp=t.timeStamp)}computeValues(t){const e=this.state;e._values=t,e.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:e,config:n,shared:i}=this;e.args=this.args;let r=0;if(t&&(e.event=t,n.preventDefault&&t.cancelable&&e.event.preventDefault(),e.type=t.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,function(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:i,metaKey:o,ctrlKey:r}=t;Object.assign(e,{shiftKey:n,altKey:i,metaKey:o,ctrlKey:r})}return e}(t)),i.down=i.pressed=i.buttons%2==1||i.touches>0,r=t.timeStamp-e.timeStamp,e.timeStamp=t.timeStamp,e.elapsedTime=e.timeStamp-e.startTime),e._active){const t=e._delta.map(Math.abs);o.addTo(e._distance,t)}this.axisIntent&&this.axisIntent(t);const[a,c]=e._movement,[d,l]=n.threshold,{_step:h,values:u}=e;if(n.hasCustomTransform?(!1===h[0]&&(h[0]=Math.abs(a)>=d&&u[0]),!1===h[1]&&(h[1]=Math.abs(c)>=l&&u[1])):(!1===h[0]&&(h[0]=Math.abs(a)>=d&&Math.sign(a)*d),!1===h[1]&&(h[1]=Math.abs(c)>=l&&Math.sign(c)*l)),e.intentional=!1!==h[0]||!1!==h[1],!e.intentional)return;const g=[0,0];if(n.hasCustomTransform){const[t,e]=u;g[0]=!1!==h[0]?t-h[0]:0,g[1]=!1!==h[1]?e-h[1]:0}else g[0]=!1!==h[0]?a-h[0]:0,g[1]=!1!==h[1]?c-h[1]:0;this.restrictToAxis&&!e._blocked&&this.restrictToAxis(g);const m=e.offset,p=e._active&&!e._blocked||e.active;p&&(e.first=e._active&&!e.active,e.last=!e._active&&e.active,e.active=i[this.ingKey]=e._active,t&&(e.first&&("bounds"in n&&(e._bounds=M(n.bounds,e)),this.setup&&this.setup()),e.movement=g,this.computeOffset()));const[f,b]=e.offset,[[x,v],[y,_]]=e._bounds;e.overflow=[f<x?-1:f>v?1:0,b<y?-1:b>_?1:0],e._movementBound[0]=!!e.overflow[0]&&(!1===e._movementBound[0]?e._movement[0]:e._movementBound[0]),e._movementBound[1]=!!e.overflow[1]&&(!1===e._movementBound[1]?e._movement[1]:e._movementBound[1]);const w=e._active&&n.rubberband||[0,0];if(e.offset=function(t,[e,n],[i,o]){const[[r,a],[c,d]]=t;return[s(e,r,a,i),s(n,c,d,o)]}(e._bounds,e.offset,w),e.delta=o.sub(e.offset,m),this.computeMovement(),p&&(!e.last||r>32)){e.delta=o.sub(e.offset,m);const t=e.delta.map(Math.abs);o.addTo(e.distance,t),e.direction=e.delta.map(Math.sign),e._direction=e._delta.map(Math.sign),!e.first&&r>0&&(e.velocity=[t[0]/r,t[1]/r],e.timeDelta=r)}}emit(){const t=this.state,e=this.shared,n=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!n.triggerAllEvents)return;const i=this.handler(d(d(d({},e),t),{},{[this.aliasKey]:t.values}));void 0!==i&&(t.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class R extends I{constructor(...t){super(...t),a(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=o.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=o.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const e=this.state,n=this.config;if(!e.axis&&t){const i="object"==typeof n.axisThreshold?n.axisThreshold[f(t)]:n.axisThreshold;e.axis=function([t,e],n){const i=Math.abs(t),o=Math.abs(e);return i>o&&i>n?"x":o>i&&o>n?"y":void 0}(e._movement,i)}e._blocked=(n.lockDirection||!!n.axis)&&!e.axis||!!n.axis&&n.axis!==e.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0}}}const k=t=>t,A={enabled:(t=!0)=>t,eventOptions:(t,e,n)=>d(d({},n.shared.eventOptions),t),preventDefault:(t=!1)=>t,triggerAllEvents:(t=!1)=>t,rubberband(t=0){switch(t){case!0:return[.15,.15];case!1:return[0,0];default:return o.toVector(t)}},from:t=>"function"==typeof t?t:null!=t?o.toVector(t):void 0,transform(t,e,n){const i=t||n.shared.transform;return this.hasCustomTransform=!!i,i||k},threshold:t=>o.toVector(t,0)},C=d(d({},A),{},{axis(t,e,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(t=0)=>t,bounds(t={}){if("function"==typeof t)return e=>C.bounds(t(e));if("current"in t)return()=>t.current;if("function"==typeof HTMLElement&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:i=-1/0,bottom:o=1/0}=t;return[[e,n],[i,o]]}}),O={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]},P="undefined"!=typeof window&&window.document&&window.document.createElement;function D(){return P&&"ontouchstart"in window||P&&window.navigator.maxTouchPoints>1}const L={isBrowser:P,gesture:function(){try{return"constructor"in GestureEvent}catch(t){return!1}}(),touch:D(),touchscreen:D(),pointer:P&&"onpointerdown"in window,pointerLock:P&&"exitPointerLock"in window.document},B={mouse:0,touch:0,pen:8},X=d(d({},C),{},{device(t,e,{pointer:{touch:n=!1,lock:i=!1,mouse:o=!1}={}}){return this.pointerLock=i&&L.pointerLock,L.touch&&n?"touch":this.pointerLock?"mouse":L.pointer&&!o?"pointer":L.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&t?250:void 0,L.touchscreen&&!1!==n)return t||(void 0!==n?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:i=1,keys:o=!0}={}}){return this.pointerButtons=i,this.keys=o,!this.pointerLock&&"pointer"===this.device&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:i=3,axis:r}){const s=o.toVector(t,n?i:r?1:0);return this.filterTaps=n,this.tapsThreshold=i,s},swipe({velocity:t=.5,distance:e=50,duration:n=250}={}){return{velocity:this.transform(o.toVector(t)),distance:this.transform(o.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return 180;case!1:return 0;default:return t}},axisThreshold:t=>t?d(d({},B),t):B,keyboardDisplacement:(t=10)=>t});function j(t){const[e,n]=t.overflow,[i,o]=t._delta,[r,s]=t._direction;(e<0&&i>0&&r<0||e>0&&i<0&&r>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&o>0&&s<0||n>0&&o<0&&s>0)&&(t._movement[1]=t._movementBound[1])}const U=d(d({},A),{},{device(t,e,{shared:n,pointer:{touch:i=!1}={}}){if(n.target&&!L.touch&&L.gesture)return"gesture";if(L.touch&&i)return"touch";if(L.touchscreen){if(L.pointer)return"pointer";if(L.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:i={}}){const o=t=>{const e=E(M(n,t),{min:-1/0,max:1/0});return[e.min,e.max]},r=t=>{const e=E(M(i,t),{min:-1/0,max:1/0});return[e.min,e.max]};return"function"!=typeof n&&"function"!=typeof i?[o(),r()]:t=>[o(t),r(t)]},threshold(t,e,n){return this.lockDirection="lock"===n.axis,o.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey:t=>void 0===t?"ctrlKey":t,pinchOnWheel:(t=!0)=>t}),z=d(d({},C),{},{mouseOnly:(t=!0)=>t}),Y=C,F=C,K=d(d({},C),{},{mouseOnly:(t=!0)=>t}),N=new Map,V=new Map;function H(t){N.set(t.key,t.engine),V.set(t.key,t.resolver)}const G={key:"drag",engine:class extends R{constructor(...t){super(...t),a(this,"ingKey","dragging")}reset(){super.reset();const t=this.state;t._pointerId=void 0,t._pointerActive=!1,t._keyboardActive=!1,t._preventScroll=!1,t._delayed=!1,t.swipe=[0,0],t.tap=!1,t.canceled=!1,t.cancel=this.cancel.bind(this)}setup(){const t=this.state;if(t._bounds instanceof HTMLElement){const e=t._bounds.getBoundingClientRect(),n=t.currentTarget.getBoundingClientRect(),i={left:e.left-n.left+t.offset[0],right:e.right-n.right+t.offset[0],top:e.top-n.top+t.offset[1],bottom:e.bottom-n.bottom+t.offset[1]};t._bounds=C.bounds(i)}}cancel(){const t=this.state;t.canceled||(t.canceled=!0,t._active=!1,setTimeout((()=>{this.compute(),this.emit()}),0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(t){const e=this.config,n=this.state;if(null!=t.buttons&&(Array.isArray(e.pointerButtons)?!e.pointerButtons.includes(t.buttons):-1!==e.pointerButtons&&e.pointerButtons!==t.buttons))return;const i=this.ctrl.setEventIds(t);e.pointerCapture&&t.target.setPointerCapture(t.pointerId),i&&i.size>1&&n._pointerActive||(this.start(t),this.setupPointer(t),n._pointerId=y(t),n._pointerActive=!0,this.computeValues(_(t)),this.computeInitial(),e.preventScrollAxis&&"mouse"!==f(t)?(n._active=!1,this.setupScrollPrevention(t)):e.delay>0?(this.setupDelayTrigger(t),e.triggerAllEvents&&(this.compute(t),this.emit())):this.startPointerDrag(t))}startPointerDrag(t){const e=this.state;e._active=!0,e._preventScroll=!0,e._delayed=!1,this.compute(t),this.emit()}pointerMove(t){const e=this.state,n=this.config;if(!e._pointerActive)return;if(e.type===t.type&&t.timeStamp===e.timeStamp)return;const i=y(t);if(void 0!==e._pointerId&&i!==e._pointerId)return;const r=_(t);return document.pointerLockElement===t.target?e._delta=[t.movementX,t.movementY]:(e._delta=o.sub(r,e._values),this.computeValues(r)),o.addTo(e._movement,e._delta),this.compute(t),e._delayed&&e.intentional?(this.timeoutStore.remove("dragDelay"),e.active=!1,void this.startPointerDrag(t)):n.preventScrollAxis&&!e._preventScroll?e.axis?e.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(e._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(t)):void 0:void this.emit()}pointerUp(t){this.ctrl.setEventIds(t);try{this.config.pointerCapture&&t.target.hasPointerCapture(t.pointerId)&&t.target.releasePointerCapture(t.pointerId)}catch(t){}const e=this.state,n=this.config;if(!e._active||!e._pointerActive)return;const i=y(t);if(void 0!==e._pointerId&&i!==e._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(t);const[o,r]=e._distance;if(e.tap=o<=n.tapsThreshold&&r<=n.tapsThreshold,e.tap&&n.filterTaps)e._force=!0;else{const[t,i]=e._delta,[o,r]=e._movement,[s,a]=n.swipe.velocity,[c,d]=n.swipe.distance,l=n.swipe.duration;if(e.elapsedTime<l){const n=Math.abs(t/e.timeDelta),l=Math.abs(i/e.timeDelta);n>s&&Math.abs(o)>c&&(e.swipe[0]=Math.sign(t)),l>a&&Math.abs(r)>d&&(e.swipe[1]=Math.sign(i))}}this.emit()}pointerClick(t){!this.state.tap&&t.detail>0&&(t.preventDefault(),t.stopPropagation())}setupPointer(t){const e=this.config,n=e.device;e.pointerLock&&t.currentTarget.requestPointerLock(),e.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(t){this.state._preventScroll&&t.cancelable&&t.preventDefault()}setupScrollPrevention(t){this.state._preventScroll=!1,function(t){"persist"in t&&"function"==typeof t.persist&&t.persist()}(t);const e=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",e),this.eventStore.add(this.sharedConfig.window,"touch","cancel",e),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,t)}setupDelayTrigger(t){this.state._delayed=!0,this.timeoutStore.add("dragDelay",(()=>{this.state._step=[0,0],this.startPointerDrag(t)}),this.config.delay)}keyDown(t){const e=O[t.key];if(e){const n=this.state,i=t.shiftKey?10:t.altKey?.1:1;this.start(t),n._delta=e(this.config.keyboardDisplacement,i),n._keyboardActive=!0,o.addTo(n._movement,n._delta),this.compute(t),this.emit()}}keyUp(t){t.key in O&&(this.state._keyboardActive=!1,this.setActive(),this.compute(t),this.emit())}bind(t){const e=this.config.device;t(e,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(t(e,"change",this.pointerMove.bind(this)),t(e,"end",this.pointerUp.bind(this)),t(e,"cancel",this.pointerUp.bind(this)),t("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(t("key","down",this.keyDown.bind(this)),t("key","up",this.keyUp.bind(this))),this.config.filterTaps&&t("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}},resolver:X},W={key:"hover",engine:class extends R{constructor(...t){super(...t),a(this,"ingKey","hovering")}enter(t){this.config.mouseOnly&&"mouse"!==t.pointerType||(this.start(t),this.computeValues(_(t)),this.compute(t),this.emit())}leave(t){if(this.config.mouseOnly&&"mouse"!==t.pointerType)return;const e=this.state;if(!e._active)return;e._active=!1;const n=_(t);e._movement=e._delta=o.sub(n,e._values),this.computeValues(n),this.compute(t),e.delta=e.movement,this.emit()}bind(t){t("pointer","enter",this.enter.bind(this)),t("pointer","leave",this.leave.bind(this))}},resolver:K},q={key:"move",engine:class extends R{constructor(...t){super(...t),a(this,"ingKey","moving")}move(t){this.config.mouseOnly&&"mouse"!==t.pointerType||(this.state._active?this.moveChange(t):this.moveStart(t),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(t){this.start(t),this.computeValues(_(t)),this.compute(t),this.computeInitial(),this.emit()}moveChange(t){if(!this.state._active)return;const e=_(t),n=this.state;n._delta=o.sub(e,n._values),o.addTo(n._movement,n._delta),this.computeValues(e),this.compute(t),this.emit()}moveEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}bind(t){t("pointer","change",this.move.bind(this)),t("pointer","leave",this.moveEnd.bind(this))}},resolver:z},J={key:"pinch",engine:class extends I{constructor(...t){super(...t),a(this,"ingKey","pinching"),a(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:e,lastOffset:n}=this.state;this.state.offset="wheel"===t?o.add(e,n):[(1+e[0])*n[0],e[1]+n[1]]}computeMovement(){const{offset:t,lastOffset:e}=this.state;this.state.movement=[t[0]/e[0],t[1]-e[1]]}axisIntent(){const t=this.state,[e,n]=t._movement;if(!t.axis){const i=30*Math.abs(e)-Math.abs(n);i<0?t.axis="angle":i>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&("scale"===this.state.axis?t[1]=0:"angle"===this.state.axis&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout((()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()}),0)}touchStart(t){this.ctrl.setEventIds(t);const e=this.state,n=this.ctrl.touchIds;if(e._active&&e._touchIds.every((t=>n.has(t))))return;if(n.size<2)return;this.start(t),e._touchIds=Array.from(n).slice(0,2);const i=v(t,e._touchIds);i&&this.pinchStart(t,i)}pointerStart(t){if(null!=t.buttons&&t.buttons%2!=1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const e=this.state,n=e._pointerEvents,i=this.ctrl.pointerIds;if(e._active&&Array.from(n.keys()).every((t=>i.has(t))))return;if(n.size<2&&n.set(t.pointerId,t),e._pointerEvents.size<2)return;this.start(t);const o=x(...Array.from(n.values()));o&&this.pinchStart(t,o)}pinchStart(t,e){this.state.origin=e.origin,this.computeValues([e.distance,e.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const e=v(t,this.state._touchIds);e&&this.pinchMove(t,e)}pointerMove(t){const e=this.state._pointerEvents;if(e.has(t.pointerId)&&e.set(t.pointerId,t),!this.state._active)return;const n=x(...Array.from(e.values()));n&&this.pinchMove(t,n)}pinchMove(t,e){const n=this.state,i=n._values[1],o=e.angle-i;let r=0;Math.abs(o)>270&&(r+=Math.sign(o)),this.computeValues([e.distance,e.angle-360*r]),n.origin=e.origin,n.turns=r,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some((t=>!this.ctrl.touchIds.has(t)))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const e=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch(t){}e._pointerEvents.has(t.pointerId)&&e._pointerEvents.delete(t.pointerId),e._active&&e._pointerEvents.size<2&&(e._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const e=this.state;e._active||(this.start(t),this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const e=this.state;this.computeValues([t.scale,t.rotation]),e.origin=[t.clientX,t.clientY];const n=e._movement;e._movement=[t.scale-1,t.rotation],e._delta=o.sub(e._movement,n),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const e=this.config.modifierKey;e&&!t[e]||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const e=this.state;e._delta=[-w(t)[1]/100*e.offset[0],0],o.addTo(e._movement,e._delta),j(e),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const e=this.config.device;e&&(t(e,"start",this[e+"Start"].bind(this)),t(e,"change",this[e+"Move"].bind(this)),t(e,"end",this[e+"End"].bind(this)),t(e,"cancel",this[e+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:U},Z={key:"scroll",engine:class extends R{constructor(...t){super(...t),a(this,"ingKey","scrolling")}scroll(t){this.state._active||this.start(t),this.scrollChange(t),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(t){t.cancelable&&t.preventDefault();const e=this.state,n=function(t){var e,n;const{scrollX:i,scrollY:o,scrollLeft:r,scrollTop:s}=t.currentTarget;return[null!==(e=null!=i?i:r)&&void 0!==e?e:0,null!==(n=null!=o?o:s)&&void 0!==n?n:0]}(t);e._delta=o.sub(n,e._values),o.addTo(e._movement,e._delta),this.computeValues(n),this.compute(t),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("scroll","",this.scroll.bind(this))}},resolver:Y},Q={key:"wheel",engine:class extends R{constructor(...t){super(...t),a(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const e=this.state;e._delta=w(t),o.addTo(e._movement,e._delta),j(e),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}},resolver:F};const tt={target(t){if(t)return()=>"current"in t?t.current:t},enabled:(t=!0)=>t,window:(t=(L.isBrowser?window:void 0))=>t,eventOptions:({passive:t=!0,capture:e=!1}={})=>({passive:t,capture:e}),transform:t=>t},et=["target","eventOptions","window","enabled","transform"];function nt(t={},e){const n={};for(const[i,o]of Object.entries(e))switch(typeof o){case"function":n[i]=o.call(n,t[i],i,t);break;case"object":n[i]=nt(t[i],o);break;case"boolean":o&&(n[i]=t[i])}return n}class it{constructor(t,e){a(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=e}add(t,e,n,i,o){const r=this._listeners,s=function(t,e=""){const n=l[t];return t+(n&&n[e]||e)}(e,n),a=d(d({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),o);t.addEventListener(s,i,a);const c=()=>{t.removeEventListener(s,i,a),r.delete(c)};return r.add(c),c}clean(){this._listeners.forEach((t=>t())),this._listeners.clear()}}class ot{constructor(){a(this,"_timeouts",new Map)}add(t,e,n=140,...i){this.remove(t),this._timeouts.set(t,window.setTimeout(e,n,...i))}remove(t){const e=this._timeouts.get(t);e&&window.clearTimeout(e)}clean(){this._timeouts.forEach((t=>{window.clearTimeout(t)})),this._timeouts.clear()}}class rt{constructor(t){var e,n;a(this,"gestures",new Set),a(this,"_targetEventStore",new it(this)),a(this,"gestureEventStores",{}),a(this,"gestureTimeoutStores",{}),a(this,"handlers",{}),a(this,"config",{}),a(this,"pointerIds",new Set),a(this,"touchIds",new Set),a(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),e=this,(n=t).drag&&st(e,"drag"),n.wheel&&st(e,"wheel"),n.scroll&&st(e,"scroll"),n.move&&st(e,"move"),n.pinch&&st(e,"pinch"),n.hover&&st(e,"hover")}setEventIds(t){return p(t)?(this.touchIds=new Set(function(t){return function(t){return Array.from(t.touches).filter((e=>{var n,i;return e.target===t.currentTarget||(null===(n=t.currentTarget)||void 0===n||null===(i=n.contains)||void 0===i?void 0:i.call(n,e.target))}))}(t).map((t=>t.identifier))}(t)),this.touchIds):"pointerId"in t?("pointerup"===t.type||"pointercancel"===t.type?this.pointerIds.delete(t.pointerId):"pointerdown"===t.type&&this.pointerIds.add(t.pointerId),this.pointerIds):void 0}applyHandlers(t,e){this.handlers=t,this.nativeHandlers=e}applyConfig(t,e){this.config=function(t,e,n={}){const i=t,{target:o,eventOptions:r,window:s,enabled:a,transform:c}=i,l=function(t,e){if(null==t)return{};var n,i,o=function(t,e){if(null==t)return{};var n,i,o={},r=Object.keys(t);for(i=0;i<r.length;i++)n=r[i],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)n=r[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}(i,et);if(n.shared=nt({target:o,eventOptions:r,window:s,enabled:a,transform:c},tt),e){const t=V.get(e);n[e]=nt(d({shared:n.shared},l),t)}else for(const t in l){const e=V.get(t);e&&(n[t]=nt(d({shared:n.shared},l[t]),e))}return n}(t,e,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const e=this.config.shared,n={};let i;if(!e.target||(i=e.target(),i)){if(e.enabled){for(const e of this.gestures){const o=this.config[e],r=at(n,o.eventOptions,!!i);o.enabled&&new(N.get(e))(this,t,e).bind(r)}const o=at(n,e.eventOptions,!!i);for(const e in this.nativeHandlers)o(e,"",(n=>this.nativeHandlers[e](d(d({},this.state.shared),{},{event:n,args:t}))),void 0,!0)}for(const t in n)n[t]=T(...n[t]);if(!i)return n;for(const t in n){const{device:e,capture:o,passive:r}=m(t);this._targetEventStore.add(i,e,"",n[t],{capture:o,passive:r})}}}}function st(t,e){t.gestures.add(e),t.gestureEventStores[e]=new it(t,e),t.gestureTimeoutStores[e]=new ot}const at=(t,e,n)=>(i,o,r,s={},a=!1)=>{var c,d;const g=null!==(c=s.capture)&&void 0!==c?c:e.capture,m=null!==(d=s.passive)&&void 0!==d?d:e.passive;let p=a?i:function(t,e="",n=!1){const i=l[t],o=i&&i[e]||e;return"on"+h(t)+h(o)+(function(t=!1,e){return t&&!u.includes(e)}(n,o)?"Capture":"")}(i,o,g);n&&m&&(p+="Passive"),t[p]=t[p]||[],t[p].push(r)},ct=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function dt(t,e,n,i,o,r){if(!t.has(n))return;if(!N.has(i))return;const s=n+"Start",a=n+"End";o[i]=t=>{let i;return t.first&&s in e&&e[s](t),n in e&&(i=e[n](t)),t.last&&a in e&&e[a](t),i},r[i]=r[i]||{}}function lt(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ht(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ht(Object(n),!0).forEach((function(e){lt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ht(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class gt{constructor(t,e,n,i,o){this._target=t,this._gestureKey=i,this._ctrl=new rt(e),this._ctrl.applyHandlers(e,o),this._ctrl.applyConfig(ut(ut({},n),{},{target:t}),i),this._ctrl.effect()}destroy(){this._ctrl.clean()}setConfig(t){this._ctrl.clean(),this._ctrl.applyConfig(ut(ut({},t),{},{target:this._target}),this._gestureKey),this._ctrl.effect()}}const mt=function(t,e,n){const i=([G,J,Z,Q,q,W].forEach(H),function(t,e,n){const{handlers:i,nativeHandlers:o,config:r}=function(t,e){const[n,i,o]=function(t){const e={},n={},i=new Set;for(let o in t)ct.test(o)?(i.add(RegExp.lastMatch),n[o]=t[o]):e[o]=t[o];return[n,e,i]}(t),r={};return dt(o,n,"onDrag","drag",r,e),dt(o,n,"onWheel","wheel",r,e),dt(o,n,"onScroll","scroll",r,e),dt(o,n,"onPinch","pinch",r,e),dt(o,n,"onMove","move",r,e),dt(o,n,"onHover","hover",r,e),{handlers:r,config:e,nativeHandlers:i}}(e,n||{});return new gt(t,i,r,void 0,o)});return i(t,e,n||{})};class pt{constructor(){this._bottomLeft={x:0,y:0},this._topRight={x:0,y:0}}get top(){return this._topRight.y}get bottom(){return this._bottomLeft.y}get left(){return this._bottomLeft.x}get right(){return this._topRight.x}get topLeft(){return{x:this.left,y:this.top}}get topRight(){return{...this._topRight}}get bottomLeft(){return{...this._bottomLeft}}get bottomRight(){return{x:this.right,y:this.bottom}}get width(){return this._topRight.x-this._bottomLeft.x}get height(){return this.topRight.y-this._bottomLeft.y}get centreX(){return this.left+this.width/2}get centreY(){return this.bottom+this.height/2}set(t,e){this._bottomLeft.x=t.x,this._bottomLeft.y=t.y,this._topRight.x=e.x,this._topRight.y=e.y}adjustAspectRatio(t,e){if(t>=e){const n=(t/e*this.height-this.width)/2;this._bottomLeft.x-=n,this._topRight.x+=n}if(t<e){const n=(e/t*this.width-this.height)/2;this._bottomLeft.y-=n,this._topRight.y+=n}}mouseToRegion(t,e,n){const i=e*(this.width/t.width),o=n*(this.height/t.height);return{regionMouseX:this.left+i,regionMouseY:this.bottom+o}}drag(t,e,n){const i=e*(this.width/t.width),o=n*(this.height/t.height);this._bottomLeft.x-=i,this._bottomLeft.y-=o,this._topRight.x-=i,this._topRight.y-=o}recentre(t,e){const n=t-this.centreX,i=e-this.centreY;this._bottomLeft.x+=n,this._bottomLeft.y+=i,this._topRight.x+=n,this._topRight.y+=i}panX(t){const e=this.width/100*t;this._bottomLeft.x-=e,this._topRight.x-=e}panY(t){const e=this.height/100*t;this._bottomLeft.y-=e,this._topRight.y-=e}zoom(t){const e=this.width/100*t/2,n=this.height/100*t/2;this._bottomLeft.x+=e,this._bottomLeft.y+=n,this._topRight.x-=e,this._topRight.y-=n}}const ft=(t,e)=>Math.random()*(e-t)+t,bt=(t,e)=>Math.floor(ft(t,e)),xt=t=>t[bt(0,t.length)],vt=()=>ft(-.1,.1),yt=()=>ft(.01,1),_t=(t,e,n,i)=>{e.width=n,e.height=i;const o=e.getContext("2d"),r=new Uint8ClampedArray(t),s=new ImageData(r,n,i);o.putImageData(s,0,0),o.scale(1,-1),o.translate(0,-i),o.drawImage(e,0,0)},wt=["jet","hsv","hot","cool","warm","spring","summer","autumn","winter","bone","copper","greys","YIOrRd","bluered","RdBu","picnic","rainbow","portland","blackbody","earth","electric","viridis","inferno","magma","plasma","rainbow-soft","bathymetry","cdom","chlorophyll","density","freesurface-blue","freesurface-red"],Mt={fractalSetId:0,juliaConstant:{x:0,y:0},colourMapId:0,regionBottomLeft:{x:-.22,y:-.7},regionTopRight:{x:-.21,y:-.69},maxIterations:128},St={fractalSetId:0,juliaConstant:{x:0,y:0},colourMapId:0,regionBottomLeft:{x:-2.25,y:-1.5},regionTopRight:{x:.75,y:1.5},maxIterations:128},Tt=64;let Et,It,Rt,kt,At,Ct,Ot,Pt=!1;const Dt=new Map,Lt=new Map;let Bt,Xt,jt,Ut,zt,Yt=128;const Ft=new pt;let Kt,Nt,Vt,$t,Ht,Gt=0,Wt=0,qt=0,Jt=!1,Zt=!1,Qt=new Map,te=0,ee=!1,ne=!1,ie=!0,oe=0;const re=()=>{ee=!0},se=()=>{ee=!1},ae=t=>{localStorage.bookmarks=JSON.stringify(Array.from(t.entries()))},ce=t=>{t.id=te++,Qt.set(t.id,t),ae(Qt)},de=t=>{Qt.set(t.id,t),ae(Qt)},le=t=>{Qt.delete(t.id),ae(Qt)},he=t=>({name:t||`Bookmark${te}`,fractalSetId:Bt,juliaConstant:{...jt},colourMapId:Ut,regionBottomLeft:{...Ft.bottomLeft},regionTopRight:{...Ft.topRight},maxIterations:Yt}),ue=t=>{xe(t)},ge="webgl",me="webgl2",pe=["experimental-webgl",ge,me],fe=(t,e,n,i)=>{const o=((t,e)=>{if((null==e?void 0:e.length)>0){const n=t.indexOf("// INSERT-COMMON-CODE-HERE\n");if(n>=0){const i=n+27,o=e.join("\n");return t.substring(0,i)+o+t.substring(i)}}return t})(e,i),r=t.createShader(n);if(t.shaderSource(r,o),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){const e=t.getShaderInfoLog(r);return console.error(`Failed to compile shader: ${e}`),null}return r},be=(t,e,n)=>{const i=Pt?["const int COLOUR_MAP_SIZE = 256;\n\nuniform int uSmoothColouring;\nuniform int uReturnIteration;\n\nvec4 loop(int maxIterations, sampler2D colourMap, vec2 z, vec2 c) {\n  int iteration = 0;\n  while (iteration < maxIterations) {\n    if (dot(z, z) >= 4.0) break;\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n    iteration++;\n  }\n\n  if (uReturnIteration > 0) {\n    int hi = (iteration & 0xff00) >> 8;\n    int lo = iteration & 0xff;\n    float hif = float(hi) / 255.0;\n    float lof = float(lo) / 255.0;\n    return vec4(lof, hif, 0.0, 1.0);\n  } else {\n    float possiblySmoothedIteration = uSmoothColouring > 0\n      ? float(iteration) - clamp(log(log(length(z))) / log(2.0), -1.0, 1.0)\n      : float(iteration);\n\n    float s = possiblySmoothedIteration / float(maxIterations);\n    float t = 0.5;\n    vec2 textureCoords = vec2(s, t);\n    return texture(colourMap, textureCoords);\n  }\n}\n"]:["// Same value as INITIAL_ITERATIONS in constants.js\nconst int MAX_ITERATIONS = 128;\n\nconst int COLOUR_MAP_SIZE = 256;\n\nuniform int uSmoothColouring;\nuniform int uReturnIteration;\n\nvec4 loop(sampler2D colourMap, vec2 z, vec2 c) {\n  int iteration = MAX_ITERATIONS;\n  for (int i = 0; i < MAX_ITERATIONS; i++) {\n    if (dot(z, z) >= 4.0) {\n      iteration = i;\n      break;\n    }\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n  }\n\n  if (uReturnIteration > 0) {\n\n    // https://stackoverflow.com/questions/36575457/opengl-es-glsl-bitwise-operations-equivalents\n    int hi = int(floor(float(iteration) / 256.0));\n    int lo = iteration - (hi * 256);\n\n    float hif = float(hi) / 255.0;\n    float lof = float(lo) / 255.0;\n    return vec4(lof, hif, 0.0, 1.0);\n  } else {\n    // http://linas.org/art-gallery/escape/escape.html\n    float possiblySmoothedIteration = uSmoothColouring > 0\n      ? float(iteration) - clamp(log(log(length(z))) / log(2.0), -1.0, 1.0)\n      : float(iteration);\n\n    float s = possiblySmoothedIteration / float(MAX_ITERATIONS);\n    float t = 0.5;\n    vec2 textureCoords = vec2(s, t);\n    return texture2D(colourMap, textureCoords);\n  }\n}\n"],o=fe(Ct,e,Ct.VERTEX_SHADER),r=fe(Ct,n,Ct.FRAGMENT_SHADER,i),s=Ct.createProgram();if(Ct.attachShader(s,o),Ct.attachShader(s,r),Ct.linkProgram(s),!Ct.getProgramParameter(s,Ct.LINK_STATUS)){const t=Ct.getProgramInfoLog(s);return void console.error(`Failed to link program: ${t}`)}if(Ct.validateProgram(s),!Ct.getProgramParameter(s,Ct.VALIDATE_STATUS)){const t=Ct.getProgramInfoLog(s);return void console.error(`Failed to validate program: ${t}`)}const a=Ct.getAttribLocation(s,"aVertexPosition");Ct.enableVertexAttribArray(a);const c=Ct.getAttribLocation(s,"aRegionPosition");Ct.enableVertexAttribArray(c);const d=Ct.createBuffer();Ct.bindBuffer(Ct.ARRAY_BUFFER,d),Ct.bufferData(Ct.ARRAY_BUFFER,32,Ct.DYNAMIC_DRAW);const l=Ct.getUniformLocation(s,"uModelViewMatrix"),h=Ct.getUniformLocation(s,"uColourMap"),u=Ct.getUniformLocation(s,"uJuliaConstant"),g=Ct.getUniformLocation(s,"uSmoothColouring"),m=Ct.getUniformLocation(s,"uReturnIteration"),p=Pt?{uMaxIterations:Ct.getUniformLocation(s,"uMaxIterations")}:void 0,f=new Float32Array([1,1,-1,1,1,-1,-1,-1]),b=Ct.createBuffer();return Ct.bindBuffer(Ct.ARRAY_BUFFER,b),Ct.bufferData(Ct.ARRAY_BUFFER,f,Ct.STATIC_DRAW),Ct.vertexAttribPointer(a,2,Ct.FLOAT,!1,0,0),{name:t,program:s,aVertexPosition:a,aRegionPosition:c,uModelViewMatrix:l,...p,uColourMap:h,uJuliaConstant:u,uSmoothColouring:g,uReturnIteration:m,vertexPositionBuffer:b,regionPositionBuffer:d}},xe=t=>{let{fractalSetId:e,juliaConstant:n,colourMapId:o,maxIterations:r,regionBottomLeft:s,regionTopRight:a}=t;s&&a&&ve((()=>{Ft.set(s,a)})),Number.isInteger(e)&&(Bt=e,Xt=Dt.get(e)),n&&(jt=n),Number.isInteger(o)&&(Ut=o,zt=Lt.get(o)),Pt&&Number.isInteger(r)&&(Yt=r),Ct.useProgram(Xt.program);const c=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}((d=new i(16),i!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0),d[0]=1,d[5]=1,d[10]=1,d[15]=1,d),[1,-1,1]);var d;Ct.uniformMatrix4fv(Xt.uModelViewMatrix,!1,c),Ct.uniform1i(Xt.uColourMap,zt.textureUnit),Ct.uniform2f(Xt.uJuliaConstant,jt.x,jt.y),Ct.uniform1i(Xt.uSmoothColouring,ie),Ct.uniform1i(Xt.uReturnIteration,!1),Pt&&Ct.uniform1i(Xt.uMaxIterations,Yt)},ve=t=>{t(),(()=>{if(!Xt)return;const{regionPositionBuffer:t,aRegionPosition:e}=Xt,n=new Float32Array([Ft.topRight.x,Ft.topRight.y,Ft.topLeft.x,Ft.topLeft.y,Ft.bottomRight.x,Ft.bottomRight.y,Ft.bottomLeft.x,Ft.bottomLeft.y]);Ct.bindBuffer(Ct.ARRAY_BUFFER,t),Ct.bufferData(Ct.ARRAY_BUFFER,n,Ct.DYNAMIC_DRAW),Ct.vertexAttribPointer(e,2,Ct.FLOAT,!1,0,0),Ct.bindBuffer(Ct.ARRAY_BUFFER,null)})()},ye=function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&Ct.uniform1i(Xt.uReturnIteration,!0),Ct.drawArrays(Ct.TRIANGLE_STRIP,0,4),t&&Ct.uniform1i(Xt.uReturnIteration,!1),Et.manualMode&&Xe()},_e=async t=>{const e=t??$t;e&&(t||(console.log("[displayConfiguration]","nextConfigurationCount:",oe),$t=void 0,oe=0),ue(e),we(),Xe(e),Gt=e.panSpeedX??vt(),Wt=e.panSpeedY??vt(),qt=e.zoomSpeed??yt()),setTimeout(_e,1e4)},we=(t,e)=>{const n=t??It.clientWidth,i=e??It.clientHeight;t||e||(It.width=n,It.height=i,Rt.setSize(n,i)),Ct.viewport(0,0,n,i),ve((()=>{Ft.adjustAspectRatio(n,i)}))},Me=()=>{we(),ye()},Se=t=>{if(t.metaKey)return;const[e,n]=t.initial;Vt={mouseX:e,mouseY:n}},Te=t=>{t.metaKey||(ve((()=>{const[e,n]=t.values,i=e-Vt.mouseX,o=n-Vt.mouseY;Ft.drag(It,i,o),Vt={mouseX:e,mouseY:n}})),ye())},Ee=t=>{t.metaKey},Ie=t=>{const[e,n]=t.origin,{regionMouseX:i,regionMouseY:o}=Ft.mouseToRegion(It,e,n);Ht={originalWidth:Ft.width,originalHeight:Ft.height,fixedX:i,fixedY:o,originalDeltaX:i-Ft.left,originalDeltaY:o-Ft.bottom}},Re=t=>{ve((()=>{const[e]=t.movement,n=Ht.originalWidth/e,i=Ht.originalDeltaX/e,o=Ht.fixedX-i,r=o+n,s=Ht.originalHeight/e,a=Ht.originalDeltaY/e,c=Ht.fixedY-a,d={x:o,y:c},l={x:r,y:c+s};Ft.set(d,l)})),ye()},ke=()=>{},Ae=t=>{const e=t.offsetX,n=t.offsetY,{regionMouseX:i,regionMouseY:o}=Ft.mouseToRegion(It,e,n);if(t.metaKey)return Jt=!0,Kt={mouseX:e,mouseY:n},void(Nt={mouseX:e,mouseY:n});if(t.shiftKey)return ve((()=>{Ft.recentre(i,o)})),ye();if(t.altKey)switch(Bt){case 0:return xe({fractalSetId:1,juliaConstant:{x:i,y:o}}),void ye();case 1:return xe({fractalSetId:0}),void ye();default:return}},Ce=t=>{const e=t.offsetX,n=t.offsetY;if(Jt)return Nt={mouseX:e,mouseY:n},void Rt.drawSelectionRegion(Kt.mouseX,Kt.mouseY,Nt.mouseX,Nt.mouseY)},Oe=()=>{if(Jt){const t=Kt,e=Nt,n=Math.max(t.mouseY,e.mouseY),i=Math.min(t.mouseY,e.mouseY),o=Math.min(t.mouseX,e.mouseX),r=Math.max(t.mouseX,e.mouseX),s=r-o,a=n-i;if(Math.hypot(s,a)>=5){const t=Ft.mouseToRegion(It,o,i),e=Ft.mouseToRegion(It,r,n),s={x:t.regionMouseX,y:t.regionMouseY},a={x:e.regionMouseX,y:e.regionMouseY};ve((()=>{Ft.set(s,a)})),we(),ye()}Rt.clearSelectionRegion(),Jt=!1}},Pe=()=>{Jt&&(Rt.clearSelectionRegion(),Kt=void 0,Nt=void 0,Jt=!1)},De=t=>{if(!ee){if(Zt)return je(t);if(Zt||"b"!==t.key){if("+"===t.key)return ve((()=>{Ft.zoom(50)})),void ye();if("-"===t.key)return ve((()=>{Ft.zoom(-100)})),void ye();if("h"===t.key)return ue(St),we(),void ye();if("c"===t.key||"C"===t.key){const e=Array.from(Lt.keys()),n=e.length,i=e.indexOf(Ut),o=e[(i+(t.shiftKey?n-1:1))%n];return xe({colourMapId:o}),void ye()}if(Pt&&("i"===t.key||"I"===t.key)){const n=16*(t.shiftKey?-1:1);return 16,4096,e=Yt+n,Yt=Math.max(16,Math.min(4096,e)),xe({maxIterations:Yt}),void ye()}var e;"s"===t.key&&(ie=!ie,xe({}),ye()),"v"===t.key&&(ne?Le():Be())}else Zt=!0}},Le=()=>{Rt.hideConfigurationSummary(),ne=!1},Be=()=>{const t=he();Rt.showConfigurationSummary(t),ne=!0},Xe=()=>{const t=he();Rt.updateConfigurationSummary(t)},je=t=>{if(Zt=!1,"n"===t.key){const t=he();return Ot.presentBookmarkModal(t)}if("l"===t.key)return Ot.presentManageBookmarksModal(Qt)},Ue=new URL(document.location);var ze;(async t=>{Et=t,It=document.getElementById("canvas"),(t=>{const e=e=>{try{Ct=t.getContext(e),Ct||console.log(`Failed to initialise WebGL (contextType: ${e})`)}catch(t){alert(`Exception trying to initialise WebGL (contextType: ${e})\n${t.message}`)}const n=Boolean(Ct);return n&&e===me&&(Pt=!0),n},n=pe.includes(Et.contextType)?Et.contextType:me;e(n)||n!==ge&&e(ge)})(It),(()=>{const t=Pt?"#version 300 es\nprecision highp float;\n\nin vec2 aVertexPosition;\nin vec2 aRegionPosition;\nuniform mat4 uModelViewMatrix;\nout vec2 vRegionPosition;\n\nvoid main(void) {\n  gl_Position = uModelViewMatrix * vec4(aVertexPosition, 0, 1);\n  vRegionPosition = aRegionPosition;\n}\n":"precision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aRegionPosition;\nuniform mat4 uModelViewMatrix;\nvarying vec2 vRegionPosition;\n\nvoid main(void) {\n  gl_Position = uModelViewMatrix * vec4(aVertexPosition, 0, 1);\n  vRegionPosition = aRegionPosition;\n}\n",e=Pt?"#version 300 es\nprecision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform int uMaxIterations;\nuniform sampler2D uColourMap;\nuniform vec2 uJuliaConstant;\nin vec2 vRegionPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 z = vRegionPosition;\n  vec2 c = uJuliaConstant;\n  fragColor = loop(uMaxIterations, uColourMap, z, c);\n}\n":"precision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform sampler2D uColourMap;\nuniform vec2 uJuliaConstant;\nvarying vec2 vRegionPosition;\n\nvoid main(void) {\n  vec2 z = vRegionPosition;\n  vec2 c = uJuliaConstant;\n  gl_FragColor = loop(uColourMap, z, c);\n}\n",n=be("Mandelbrot",t,Pt?"#version 300 es\nprecision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform int uMaxIterations;\nuniform sampler2D uColourMap;\nin vec2 vRegionPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 z;\n  vec2 c = vRegionPosition;\n  fragColor = loop(uMaxIterations, uColourMap, z, c);\n}\n":"precision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform sampler2D uColourMap;\nvarying vec2 vRegionPosition;\n\nvoid main(void) {\n  vec2 z;\n  vec2 c = vRegionPosition;\n  gl_FragColor = loop(uColourMap, z, c);\n}\n"),i=be("Julia",t,e);Dt.set(0,n),Dt.set(1,i)})(),(()=>{const t=Ct.getParameter(Ct.MAX_COMBINED_TEXTURE_IMAGE_UNITS)-1;wt.slice(0,t).forEach(((t,n)=>{const i=n+1;Lt.set(n,((t,n)=>{const i=e()({colormap:t,nshades:256,format:"float"}).flat();return((t,e)=>{const n=Ct.createTexture();Ct.activeTexture(Ct.TEXTURE0+e),Ct.bindTexture(Ct.TEXTURE_2D,n),Ct.texParameteri(Ct.TEXTURE_2D,Ct.TEXTURE_WRAP_S,Ct.CLAMP_TO_EDGE),Ct.texParameteri(Ct.TEXTURE_2D,Ct.TEXTURE_WRAP_T,Ct.CLAMP_TO_EDGE),Ct.texParameteri(Ct.TEXTURE_2D,Ct.TEXTURE_MIN_FILTER,Ct.LINEAR),Ct.texParameteri(Ct.TEXTURE_2D,Ct.TEXTURE_MAG_FILTER,Ct.LINEAR);const i=new Uint8Array(t.map((t=>255*t))),o=t.length/4;Ct.texImage2D(Ct.TEXTURE_2D,0,Ct.RGBA,o,1,0,Ct.RGBA,Ct.UNSIGNED_BYTE,i)})(i,n),{name:t,colourMap:i,textureUnit:n}})(t,i))}))})(),Rt=(t=>{let{fractalSets:e,colourMaps:n}=t;const i=document.getElementById("canvasOverlay"),o=i.getContext("2d"),r=document.getElementById("divOverlay"),s=document.getElementById("configurationSummary");let a,c=!1;const d=()=>{o.clearRect(0,0,i.width,i.height)},l=t=>{let{x:e,y:n}=t;return`(${e}, ${n})`},h=t=>{var i,o;const r=1===t.fractalSetId?l(t.juliaConstant):"",a=`${l(t.regionBottomLeft)}, ${l(t.regionTopRight)}`,c=[(null===(i=e.get(t.fractalSetId))||void 0===i?void 0:i.name)??"unknown",r,a,(null===(o=n.get(t.colourMapId))||void 0===o?void 0:o.name)??"unknown",t.maxIterations];s.innerText=c.filter(Boolean).join(" | ")},u=()=>{s.style.display="block"},g=()=>{s.style.display="none"},m=()=>{clearTimeout(a),a=void 0};return{setSize:(t,e)=>{i.width=t,i.height=e,r.width=t,r.height=e},drawSelectionRegion:(t,e,n,i)=>{d();const r=Math.max(e,i),s=Math.min(e,i),a=Math.min(t,n),c=Math.max(t,n)-a,l=r-s;o.lineWidth=2,o.strokeStyle="#FFFFFF80",o.strokeRect(a,s,c,l)},clearSelectionRegion:d,showConfigurationSummary:t=>{h(t),u(),m(),c=!0},hideConfigurationSummary:()=>{g(),m(),c=!1},updateConfigurationSummary:t=>{h(t),c||(u(),m(),a=setTimeout((()=>{g(),a=void 0}),5e3))}}})({fractalSets:Dt,colourMaps:Lt}),kt=(t=>{let{gl:e,createBookmark:n,switchToBookmark:i,setCanvasAndViewportSize:o,render:r}=t;return{renderThumbnail:(t,s,a,c)=>{const d=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,d),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,s,0,e.RGBA,e.UNSIGNED_BYTE,null);const l=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,l),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,d,0);const h=n("saved-configuration");i(a),o(t,s),r(c);const u=new Uint8Array(t*s*4);return e.readPixels(0,0,t,s,e.RGBA,e.UNSIGNED_BYTE,u),i(h),o(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(l),e.bindTexture(e.TEXTURE_2D,null),e.deleteTexture(d),u}}})({gl:Ct,createBookmark:he,switchToBookmark:ue,setCanvasAndViewportSize:we,render:ye});const n=Array.from(Dt.keys()),i=Array.from(Lt.keys());if(At=(t=>{let{renderThumbnail:e,fractalSetIds:n,colourMapIds:i,preview:o}=t;const r=document.getElementById("canvas"),s=document.getElementById("preview-panel"),a=document.getElementById("preview-initial"),c=document.getElementById("preview-final"),d=(t,n,i,o)=>{const r=e(n,i,t,!0),s=new Set;for(let t=0;t<r.length;t+=4){const e=r[t]+(r[t+1]<<8);s.add(e)}const a=Array.from(s).length,c=t.maxIterations,d=.6*c,l=a>=d;if(l){const t={type:o,numUniqueIterationValues:a,threshold:d,maxIterations:c};console.log("[configureConfigurationChooser]",JSON.stringify(t,null,2))}return l};return{chooseConfiguration:t=>{const l=(()=>{const t=xt(n),e=xt(i),o=ft(-2,.75),r=ft(-1.5,1.5),s=ft(.01,.5);return{fractalSetId:t,juliaConstant:{x:o,y:r},colourMapId:e,regionBottomLeft:{x:o-s,y:r-s},regionTopRight:{x:o+s,y:r+s},maxIterations:bt(32,1024),panSpeedX:vt(),panSpeedY:vt(),zoomSpeed:yt()}})(),h=r.clientWidth/r.clientHeight,u=new pt;u.set(l.regionBottomLeft,l.regionTopRight),u.adjustAspectRatio(r.clientWidth,r.clientHeight),l.regionBottomLeft=u.bottomLeft,l.regionTopRight=u.topRight;const g=64,m=Math.round(64/h);if(d(l,g,m,"initial")){const n=((t,e)=>{const n=60*e,i=new pt;i.set(t.regionBottomLeft,t.regionTopRight);for(let e=0;e<n;e++)i.panX(t.panSpeedX),i.panY(t.panSpeedY),i.zoom(t.zoomSpeed);return{...t,regionBottomLeft:i.bottomLeft,regionTopRight:i.topRight}})(l,t);if(d(n,g,m,"final")){if(o){s.style.visibility="visible";const t=e(g,m,l),i=e(g,m,n);_t(t,a,g,m),_t(i,c,g,m)}return l}}}}})({renderThumbnail:kt.renderThumbnail,fractalSetIds:n,colourMapIds:i,preview:Et.preview}),Ot=(t=>{let{isWebGL2:e,renderThumbnail:n,addBookmark:i,updateBookmark:o,deleteBookmark:r,switchToBookmark:s,fractalSets:a,colourMaps:c,onModalOpen:d,onModalClose:l}=t;const h=t=>{console.log("[presentBookmarkModal]","bookmark:",t);const r=$("#bookmarkModal").on("show.bs.modal",d).on("hide.bs.modal",l),s=Number.isInteger(t.id),h=s?"Edit Bookmark":"Create Bookmark";$(".modal-title",r).text(h),$('input[type="submit"]',r).off("click").on("click",(e=>{e.preventDefault(),t.name=$("#name",r).val(),s?o(t):i(t),r.modal("hide")}));const u=$("#thumbnail-canvas",r).get(0),g=n(Tt,Tt,t);_t(g,u,Tt,Tt),$("#name",r).val(t.name).focus(),$(".fractal-set",r).text(a.get(t.fractalSetId).name);const m=$("#colour-map-select",r).empty();for(const[e,n]of c){const i=e===t.colourMapId?"selected":"";m.append(`<option value="${e}" ${i}>${n.name}</option>`)}m.on("change",(e=>{t.colourMapId=Number(e.target.value);const i=n(Tt,Tt,t);_t(i,u,Tt,Tt)}));const p=$("#max-iterations",r);p.text(t.maxIterations);const f=$("#max-iterations-range",r);e?(f.attr("min",16).attr("max",4096).attr("step",16).val(t.maxIterations),f.on("input",(e=>{t.maxIterations=Number(e.target.value),p.text(t.maxIterations);const i=n(Tt,Tt,t);_t(i,u,Tt,Tt)}))):f.hide(),$(".region-bottom-left",r).text(`(${t.regionBottomLeft.x}, ${t.regionBottomLeft.y})`),$(".region-top-right",r).text(`(${t.regionTopRight.x}, ${t.regionTopRight.y})`);const b=$(".julia-constant",r),x=b.closest("div");1===t.fractalSetId?(b.text(`(${t.juliaConstant.x}, ${t.juliaConstant.y})`),x.show()):x.hide(),r.modal()};return{presentBookmarkModal:h,presentManageBookmarksModal:t=>{console.log("[presentManageBookmarksModal]","bookmarks:",t);const e=$("#manageBookmarksModal").on("show.bs.modal",d).on("hide.bs.modal",l),i=$("tbody",e).empty(),o=(t,n)=>()=>{e.modal("hide"),t(n)},a=t=>s(t),c=t=>{const e={...t};h(e)},u=t=>{r(t)},g=document.getElementById("bookmark-row-template");t.forEach((t=>{const e=document.importNode(g.content,!0),r=e.querySelector(":nth-child(2)"),s=e.querySelector(":nth-child(3) i"),d=e.querySelector(":nth-child(4) i"),l=e.querySelector(":nth-child(1) canvas"),h=n(Tt,Tt,t);_t(h,l,Tt,Tt),r.innerText=t.name,l.addEventListener("click",o(a,t)),s.addEventListener("click",o(c,t)),d.addEventListener("click",o(u,t)),i.append(e)})),e.modal()}}})({isWebGL2:Pt,renderThumbnail:kt.renderThumbnail,addBookmark:ce,updateBookmark:de,deleteBookmark:le,switchToBookmark:t=>{ue(t),we(),ye()},fractalSets:Dt,colourMaps:Lt,onModalOpen:re,onModalClose:se}),window.addEventListener("resize",Me),Et.manualMode)It.addEventListener("mousedown",Ae),It.addEventListener("mousemove",Ce),It.addEventListener("mouseup",Oe),It.addEventListener("mouseleave",Pe),document.addEventListener("keydown",De),new mt(It,{onDragStart:Se,onDrag:Te,onDragEnd:Ee,onPinchStart:Ie,onPinch:Re,onPinchEnd:ke}),(t=>{const e=JSON.parse(localStorage.bookmarks||"[]");for(const[n,i]of e){const{thumbnail:e,...o}=i;t.set(n,o)}})(Qt),te=Qt.size?Math.max(...Qt.keys())+1:0,ue(Mt),we(),ye();else{_e(Mt);const t=()=>{ve((()=>{Ft.panX(Gt),Ft.panY(Wt),Ft.zoom(qt)})),ye(),requestAnimationFrame(t),$t||($t=At.chooseConfiguration(10),oe++)};t()}})({manualMode:"manual"===Ue.searchParams.get("mode"),contextType:Ue.searchParams.get("contextType"),preview:(ze=Ue.searchParams.get("preview"),["","true","1","on"].includes(null==ze?void 0:ze.toLowerCase()))})})()})();
//# sourceMappingURL=bundle.js.map