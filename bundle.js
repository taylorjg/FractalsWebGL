(()=>{var e={440:e=>{e.exports={jet:[{index:0,rgb:[0,0,131]},{index:.125,rgb:[0,60,170]},{index:.375,rgb:[5,255,255]},{index:.625,rgb:[255,255,0]},{index:.875,rgb:[250,0,0]},{index:1,rgb:[128,0,0]}],hsv:[{index:0,rgb:[255,0,0]},{index:.169,rgb:[253,255,2]},{index:.173,rgb:[247,255,2]},{index:.337,rgb:[0,252,4]},{index:.341,rgb:[0,252,10]},{index:.506,rgb:[1,249,255]},{index:.671,rgb:[2,0,253]},{index:.675,rgb:[8,0,253]},{index:.839,rgb:[255,0,251]},{index:.843,rgb:[255,0,245]},{index:1,rgb:[255,0,6]}],hot:[{index:0,rgb:[0,0,0]},{index:.3,rgb:[230,0,0]},{index:.6,rgb:[255,210,0]},{index:1,rgb:[255,255,255]}],spring:[{index:0,rgb:[255,0,255]},{index:1,rgb:[255,255,0]}],summer:[{index:0,rgb:[0,128,102]},{index:1,rgb:[255,255,102]}],autumn:[{index:0,rgb:[255,0,0]},{index:1,rgb:[255,255,0]}],winter:[{index:0,rgb:[0,0,255]},{index:1,rgb:[0,255,128]}],bone:[{index:0,rgb:[0,0,0]},{index:.376,rgb:[84,84,116]},{index:.753,rgb:[169,200,200]},{index:1,rgb:[255,255,255]}],copper:[{index:0,rgb:[0,0,0]},{index:.804,rgb:[255,160,102]},{index:1,rgb:[255,199,127]}],greys:[{index:0,rgb:[0,0,0]},{index:1,rgb:[255,255,255]}],yignbu:[{index:0,rgb:[8,29,88]},{index:.125,rgb:[37,52,148]},{index:.25,rgb:[34,94,168]},{index:.375,rgb:[29,145,192]},{index:.5,rgb:[65,182,196]},{index:.625,rgb:[127,205,187]},{index:.75,rgb:[199,233,180]},{index:.875,rgb:[237,248,217]},{index:1,rgb:[255,255,217]}],greens:[{index:0,rgb:[0,68,27]},{index:.125,rgb:[0,109,44]},{index:.25,rgb:[35,139,69]},{index:.375,rgb:[65,171,93]},{index:.5,rgb:[116,196,118]},{index:.625,rgb:[161,217,155]},{index:.75,rgb:[199,233,192]},{index:.875,rgb:[229,245,224]},{index:1,rgb:[247,252,245]}],yiorrd:[{index:0,rgb:[128,0,38]},{index:.125,rgb:[189,0,38]},{index:.25,rgb:[227,26,28]},{index:.375,rgb:[252,78,42]},{index:.5,rgb:[253,141,60]},{index:.625,rgb:[254,178,76]},{index:.75,rgb:[254,217,118]},{index:.875,rgb:[255,237,160]},{index:1,rgb:[255,255,204]}],bluered:[{index:0,rgb:[0,0,255]},{index:1,rgb:[255,0,0]}],rdbu:[{index:0,rgb:[5,10,172]},{index:.35,rgb:[106,137,247]},{index:.5,rgb:[190,190,190]},{index:.6,rgb:[220,170,132]},{index:.7,rgb:[230,145,90]},{index:1,rgb:[178,10,28]}],picnic:[{index:0,rgb:[0,0,255]},{index:.1,rgb:[51,153,255]},{index:.2,rgb:[102,204,255]},{index:.3,rgb:[153,204,255]},{index:.4,rgb:[204,204,255]},{index:.5,rgb:[255,255,255]},{index:.6,rgb:[255,204,255]},{index:.7,rgb:[255,153,255]},{index:.8,rgb:[255,102,204]},{index:.9,rgb:[255,102,102]},{index:1,rgb:[255,0,0]}],rainbow:[{index:0,rgb:[150,0,90]},{index:.125,rgb:[0,0,200]},{index:.25,rgb:[0,25,255]},{index:.375,rgb:[0,152,255]},{index:.5,rgb:[44,255,150]},{index:.625,rgb:[151,255,0]},{index:.75,rgb:[255,234,0]},{index:.875,rgb:[255,111,0]},{index:1,rgb:[255,0,0]}],portland:[{index:0,rgb:[12,51,131]},{index:.25,rgb:[10,136,186]},{index:.5,rgb:[242,211,56]},{index:.75,rgb:[242,143,56]},{index:1,rgb:[217,30,30]}],blackbody:[{index:0,rgb:[0,0,0]},{index:.2,rgb:[230,0,0]},{index:.4,rgb:[230,210,0]},{index:.7,rgb:[255,255,255]},{index:1,rgb:[160,200,255]}],earth:[{index:0,rgb:[0,0,130]},{index:.1,rgb:[0,180,180]},{index:.2,rgb:[40,210,40]},{index:.4,rgb:[230,230,50]},{index:.6,rgb:[120,70,20]},{index:1,rgb:[255,255,255]}],electric:[{index:0,rgb:[0,0,0]},{index:.15,rgb:[30,0,100]},{index:.4,rgb:[120,0,100]},{index:.6,rgb:[160,90,0]},{index:.8,rgb:[230,200,0]},{index:1,rgb:[255,250,220]}],alpha:[{index:0,rgb:[255,255,255,0]},{index:1,rgb:[255,255,255,1]}],viridis:[{index:0,rgb:[68,1,84]},{index:.13,rgb:[71,44,122]},{index:.25,rgb:[59,81,139]},{index:.38,rgb:[44,113,142]},{index:.5,rgb:[33,144,141]},{index:.63,rgb:[39,173,129]},{index:.75,rgb:[92,200,99]},{index:.88,rgb:[170,220,50]},{index:1,rgb:[253,231,37]}],inferno:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[31,12,72]},{index:.25,rgb:[85,15,109]},{index:.38,rgb:[136,34,106]},{index:.5,rgb:[186,54,85]},{index:.63,rgb:[227,89,51]},{index:.75,rgb:[249,140,10]},{index:.88,rgb:[249,201,50]},{index:1,rgb:[252,255,164]}],magma:[{index:0,rgb:[0,0,4]},{index:.13,rgb:[28,16,68]},{index:.25,rgb:[79,18,123]},{index:.38,rgb:[129,37,129]},{index:.5,rgb:[181,54,122]},{index:.63,rgb:[229,80,100]},{index:.75,rgb:[251,135,97]},{index:.88,rgb:[254,194,135]},{index:1,rgb:[252,253,191]}],plasma:[{index:0,rgb:[13,8,135]},{index:.13,rgb:[75,3,161]},{index:.25,rgb:[125,3,168]},{index:.38,rgb:[168,34,150]},{index:.5,rgb:[203,70,121]},{index:.63,rgb:[229,107,93]},{index:.75,rgb:[248,148,65]},{index:.88,rgb:[253,195,40]},{index:1,rgb:[240,249,33]}],warm:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[172,0,187]},{index:.25,rgb:[219,0,170]},{index:.38,rgb:[255,0,130]},{index:.5,rgb:[255,63,74]},{index:.63,rgb:[255,123,0]},{index:.75,rgb:[234,176,0]},{index:.88,rgb:[190,228,0]},{index:1,rgb:[147,255,0]}],cool:[{index:0,rgb:[125,0,179]},{index:.13,rgb:[116,0,218]},{index:.25,rgb:[98,74,237]},{index:.38,rgb:[68,146,231]},{index:.5,rgb:[0,204,197]},{index:.63,rgb:[0,247,146]},{index:.75,rgb:[0,255,88]},{index:.88,rgb:[40,255,8]},{index:1,rgb:[147,255,0]}],"rainbow-soft":[{index:0,rgb:[125,0,179]},{index:.1,rgb:[199,0,180]},{index:.2,rgb:[255,0,121]},{index:.3,rgb:[255,108,0]},{index:.4,rgb:[222,194,0]},{index:.5,rgb:[150,255,0]},{index:.6,rgb:[0,255,55]},{index:.7,rgb:[0,246,150]},{index:.8,rgb:[50,167,222]},{index:.9,rgb:[103,51,235]},{index:1,rgb:[124,0,186]}],bathymetry:[{index:0,rgb:[40,26,44]},{index:.13,rgb:[59,49,90]},{index:.25,rgb:[64,76,139]},{index:.38,rgb:[63,110,151]},{index:.5,rgb:[72,142,158]},{index:.63,rgb:[85,174,163]},{index:.75,rgb:[120,206,163]},{index:.88,rgb:[187,230,172]},{index:1,rgb:[253,254,204]}],cdom:[{index:0,rgb:[47,15,62]},{index:.13,rgb:[87,23,86]},{index:.25,rgb:[130,28,99]},{index:.38,rgb:[171,41,96]},{index:.5,rgb:[206,67,86]},{index:.63,rgb:[230,106,84]},{index:.75,rgb:[242,149,103]},{index:.88,rgb:[249,193,135]},{index:1,rgb:[254,237,176]}],chlorophyll:[{index:0,rgb:[18,36,20]},{index:.13,rgb:[25,63,41]},{index:.25,rgb:[24,91,59]},{index:.38,rgb:[13,119,72]},{index:.5,rgb:[18,148,80]},{index:.63,rgb:[80,173,89]},{index:.75,rgb:[132,196,122]},{index:.88,rgb:[175,221,162]},{index:1,rgb:[215,249,208]}],density:[{index:0,rgb:[54,14,36]},{index:.13,rgb:[89,23,80]},{index:.25,rgb:[110,45,132]},{index:.38,rgb:[120,77,178]},{index:.5,rgb:[120,113,213]},{index:.63,rgb:[115,151,228]},{index:.75,rgb:[134,185,227]},{index:.88,rgb:[177,214,227]},{index:1,rgb:[230,241,241]}],"freesurface-blue":[{index:0,rgb:[30,4,110]},{index:.13,rgb:[47,14,176]},{index:.25,rgb:[41,45,236]},{index:.38,rgb:[25,99,212]},{index:.5,rgb:[68,131,200]},{index:.63,rgb:[114,156,197]},{index:.75,rgb:[157,181,203]},{index:.88,rgb:[200,208,216]},{index:1,rgb:[241,237,236]}],"freesurface-red":[{index:0,rgb:[60,9,18]},{index:.13,rgb:[100,17,27]},{index:.25,rgb:[142,20,29]},{index:.38,rgb:[177,43,27]},{index:.5,rgb:[192,87,63]},{index:.63,rgb:[205,125,105]},{index:.75,rgb:[216,162,148]},{index:.88,rgb:[227,199,193]},{index:1,rgb:[241,237,236]}],oxygen:[{index:0,rgb:[64,5,5]},{index:.13,rgb:[106,6,15]},{index:.25,rgb:[144,26,7]},{index:.38,rgb:[168,64,3]},{index:.5,rgb:[188,100,4]},{index:.63,rgb:[206,136,11]},{index:.75,rgb:[220,174,25]},{index:.88,rgb:[231,215,44]},{index:1,rgb:[248,254,105]}],par:[{index:0,rgb:[51,20,24]},{index:.13,rgb:[90,32,35]},{index:.25,rgb:[129,44,34]},{index:.38,rgb:[159,68,25]},{index:.5,rgb:[182,99,19]},{index:.63,rgb:[199,134,22]},{index:.75,rgb:[212,171,35]},{index:.88,rgb:[221,210,54]},{index:1,rgb:[225,253,75]}],phase:[{index:0,rgb:[145,105,18]},{index:.13,rgb:[184,71,38]},{index:.25,rgb:[186,58,115]},{index:.38,rgb:[160,71,185]},{index:.5,rgb:[110,97,218]},{index:.63,rgb:[50,123,164]},{index:.75,rgb:[31,131,110]},{index:.88,rgb:[77,129,34]},{index:1,rgb:[145,105,18]}],salinity:[{index:0,rgb:[42,24,108]},{index:.13,rgb:[33,50,162]},{index:.25,rgb:[15,90,145]},{index:.38,rgb:[40,118,137]},{index:.5,rgb:[59,146,135]},{index:.63,rgb:[79,175,126]},{index:.75,rgb:[120,203,104]},{index:.88,rgb:[193,221,100]},{index:1,rgb:[253,239,154]}],temperature:[{index:0,rgb:[4,35,51]},{index:.13,rgb:[23,51,122]},{index:.25,rgb:[85,59,157]},{index:.38,rgb:[129,79,143]},{index:.5,rgb:[175,95,130]},{index:.63,rgb:[222,112,101]},{index:.75,rgb:[249,146,66]},{index:.88,rgb:[249,196,65]},{index:1,rgb:[232,250,91]}],turbidity:[{index:0,rgb:[34,31,27]},{index:.13,rgb:[65,50,41]},{index:.25,rgb:[98,69,52]},{index:.38,rgb:[131,89,57]},{index:.5,rgb:[161,112,59]},{index:.63,rgb:[185,140,66]},{index:.75,rgb:[202,174,88]},{index:.88,rgb:[216,209,126]},{index:1,rgb:[233,246,171]}],"velocity-blue":[{index:0,rgb:[17,32,64]},{index:.13,rgb:[35,52,116]},{index:.25,rgb:[29,81,156]},{index:.38,rgb:[31,113,162]},{index:.5,rgb:[50,144,169]},{index:.63,rgb:[87,173,176]},{index:.75,rgb:[149,196,189]},{index:.88,rgb:[203,221,211]},{index:1,rgb:[254,251,230]}],"velocity-green":[{index:0,rgb:[23,35,19]},{index:.13,rgb:[24,64,38]},{index:.25,rgb:[11,95,45]},{index:.38,rgb:[39,123,35]},{index:.5,rgb:[95,146,12]},{index:.63,rgb:[152,165,18]},{index:.75,rgb:[201,186,69]},{index:.88,rgb:[233,216,137]},{index:1,rgb:[255,253,205]}],cubehelix:[{index:0,rgb:[0,0,0]},{index:.07,rgb:[22,5,59]},{index:.13,rgb:[60,4,105]},{index:.2,rgb:[109,1,135]},{index:.27,rgb:[161,0,147]},{index:.33,rgb:[210,2,142]},{index:.4,rgb:[251,11,123]},{index:.47,rgb:[255,29,97]},{index:.53,rgb:[255,54,69]},{index:.6,rgb:[255,85,46]},{index:.67,rgb:[255,120,34]},{index:.73,rgb:[255,157,37]},{index:.8,rgb:[241,191,57]},{index:.87,rgb:[224,220,93]},{index:.93,rgb:[218,241,142]},{index:1,rgb:[227,253,198]}]}},800:(e,t,n)=>{"use strict";var i=n(440),r=n(450);function o(e){return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function s(e){for(var t,n="#",i=0;i<3;++i)n+=("00"+(t=(t=e[i]).toString(16))).substr(t.length);return n}function a(e){return"rgba("+e.join(",")+")"}e.exports=function(e){var t,n,d,c,u,g,l,h,b,f;if(e||(e={}),h=(e.nshades||72)-1,l=e.format||"hex",(g=e.colormap)||(g="jet"),"string"==typeof g){if(g=g.toLowerCase(),!i[g])throw Error(g+" not a supported colorscale");u=i[g]}else{if(!Array.isArray(g))throw Error("unsupported colormap option",g);u=g.slice()}if(u.length>h+1)throw new Error(g+" map requires nshades to be at least size "+u.length);b=Array.isArray(e.alpha)?2!==e.alpha.length?[1,1]:e.alpha.slice():"number"==typeof e.alpha?[e.alpha,e.alpha]:[1,1],t=u.map((function(e){return Math.round(e.index*h)})),b[0]=Math.min(Math.max(b[0],0),1),b[1]=Math.min(Math.max(b[1],0),1);var m=u.map((function(e,t){var n=u[t].index,i=u[t].rgb.slice();return 4===i.length&&i[3]>=0&&i[3]<=1||(i[3]=b[0]+(b[1]-b[0])*n),i})),p=[];for(f=0;f<t.length-1;++f){c=t[f+1]-t[f],n=m[f],d=m[f+1];for(var x=0;x<c;x++){var v=x/c;p.push([Math.round(r(n[0],d[0],v)),Math.round(r(n[1],d[1],v)),Math.round(r(n[2],d[2],v)),r(n[3],d[3],v)])}}return p.push(u[u.length-1].rgb.concat(b[1])),"hex"===l?p=p.map(s):"rgbaString"===l?p=p.map(a):"float"===l&&(p=p.map(o)),p}},450:e=>{e.exports=function(e,t,n){return e*(1-n)+t*n}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(800),t=n.n(e),i="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});const r={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function o(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function s(e,t,n,i=.15){return 0===i?function(e,t,n){return Math.max(t,Math.min(e,n))}(e,t,n):e<t?-o(t-e,n-t,i)+t:e>n?+o(e-n,n-t,i)+n:e}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const u={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function g(e){return e?e[0].toUpperCase()+e.slice(1):""}const l=["enter","leave"];const h=["gotpointercapture","lostpointercapture"];function b(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const i=h.includes(t)?"capturecapture":"capture",r=!!~t.indexOf(i);return r&&(t=t.replace("capture","")),{device:t,capture:r,passive:n}}function f(e){return"touches"in e}function m(e){return f(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function p(e){return f(e)?function(e){return"touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches}(e)[0]:e}function x(e){const t=p(e);return f(e)?t.identifier:t.pointerId}function v(e){const t=p(e);return[t.clientX,t.clientY]}function y(e,...t){return"function"==typeof e?e(...t):e}function _(){}function w(...e){return 0===e.length?_:1===e.length?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function T(e,t){return Object.assign({},t,e||{})}class S{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:n,args:i}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?y(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:n,shared:i}=this;t.args=this.args;let o=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,function(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:i,metaKey:r,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:i,metaKey:r,ctrlKey:o})}return t}(e)),i.down=i.pressed=i.buttons%2==1||i.touches>0,o=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const e=t._delta.map(Math.abs);r.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);const[a,d]=t._movement,[c,u]=n.threshold,{_step:g,values:l}=t;if(n.hasCustomTransform?(!1===g[0]&&(g[0]=Math.abs(a)>=c&&l[0]),!1===g[1]&&(g[1]=Math.abs(d)>=u&&l[1])):(!1===g[0]&&(g[0]=Math.abs(a)>=c&&Math.sign(a)*c),!1===g[1]&&(g[1]=Math.abs(d)>=u&&Math.sign(d)*u)),t.intentional=!1!==g[0]||!1!==g[1],!t.intentional)return;const h=[0,0];if(n.hasCustomTransform){const[e,t]=l;h[0]=!1!==g[0]?e-g[0]:0,h[1]=!1!==g[1]?t-g[1]:0}else h[0]=!1!==g[0]?a-g[0]:0,h[1]=!1!==g[1]?d-g[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);const b=t.offset,f=t._active&&!t._blocked||t.active;f&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=y(n.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));const[m,p]=t.offset,[[x,v],[_,w]]=t._bounds;t.overflow=[m<x?-1:m>v?1:0,p<_?-1:p>w?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);const T=t._active&&n.rubberband||[0,0];if(t.offset=function(e,[t,n],[i,r]){const[[o,a],[d,c]]=e;return[s(t,o,a,i),s(n,d,c,r)]}(t._bounds,t.offset,T),t.delta=r.sub(t.offset,b),this.computeMovement(),f&&(!t.last||o>32)){t.delta=r.sub(t.offset,b);const e=t.delta.map(Math.abs);r.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&o>0&&(t.velocity=[e[0]/o,e[1]/o],t.timeDelta=o)}}emit(){const e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;const i=this.handler(c(c(c({},t),e),{},{[this.aliasKey]:e.values}));void 0!==i&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class M extends S{constructor(...e){super(...e),a(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=r.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=r.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,n=this.config;if(!t.axis&&e){const i="object"==typeof n.axisThreshold?n.axisThreshold[m(e)]:n.axisThreshold;t.axis=function([e,t],n){const i=Math.abs(e),r=Math.abs(t);return i>r&&i>n?"x":r>i&&r>n?"y":void 0}(t._movement,i)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}const R=e=>e,k={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>c(c({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return r.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?r.toVector(e):void 0,transform(e,t,n){const i=e||n.shared.transform;return this.hasCustomTransform=!!i,i||R},threshold:e=>r.toVector(e,0)},I=c(c({},k),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=0)=>e,bounds(e={}){if("function"==typeof e)return t=>I.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:i=-1/0,bottom:r=1/0}=e;return[[t,n],[i,r]]}}),E={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]},A="undefined"!=typeof window&&window.document&&window.document.createElement;function C(){return A&&"ontouchstart"in window||A&&window.navigator.maxTouchPoints>1}const O={isBrowser:A,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:C(),touchscreen:C(),pointer:A&&"onpointerdown"in window,pointerLock:A&&"exitPointerLock"in window.document},P={mouse:0,touch:0,pen:8},L=c(c({},I),{},{device(e,t,{pointer:{touch:n=!1,lock:i=!1,mouse:r=!1}={}}){return this.pointerLock=i&&O.pointerLock,O.touch&&n?"touch":this.pointerLock?"mouse":O.pointer&&!r?"pointer":O.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,O.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:i=1,keys:r=!0}={}}){return this.pointerButtons=i,this.keys=r,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:i=3,axis:o}){const s=r.toVector(e,n?i:o?1:0);return this.filterTaps=n,this.tapsThreshold=i,s},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(r.toVector(e)),distance:this.transform(r.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?c(c({},P),e):P,keyboardDisplacement:(e=10)=>e});c(c({},k),{},{device(e,t,{shared:n,pointer:{touch:i=!1}={}}){if(n.target&&!O.touch&&O.gesture)return"gesture";if(O.touch&&i)return"touch";if(O.touchscreen){if(O.pointer)return"pointer";if(O.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:i={}}){const r=e=>{const t=T(y(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},o=e=>{const t=T(y(i,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof i?[r(),o()]:e=>[r(e),o(e)]},threshold(e,t,n){return this.lockDirection="lock"===n.axis,r.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e}),c(c({},I),{},{mouseOnly:(e=!0)=>e}),c(c({},I),{},{mouseOnly:(e=!0)=>e});const D=new Map,B=new Map,j={key:"drag",engine:class extends M{constructor(...e){super(...e),a(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const t=e._bounds.getBoundingClientRect(),n=e.currentTarget.getBoundingClientRect(),i={left:t.left-n.left+e.offset[0],right:t.right-n.right+e.offset[0],top:t.top-n.top+e.offset[1],bottom:t.bottom-n.bottom+e.offset[1]};e._bounds=I.bounds(i)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout((()=>{this.compute(),this.emit()}),0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const t=this.config,n=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;const i=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),i&&i.size>1&&n._pointerActive||(this.start(e),this.setupPointer(e),n._pointerId=x(e),n._pointerActive=!0,this.computeValues(v(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==m(e)?(n._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const t=this.state,n=this.config;if(!t._pointerActive)return;if(t.type===e.type&&e.timeStamp===t.timeStamp)return;const i=x(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;const o=v(e);return document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=r.sub(o,t._values),this.computeValues(o)),r.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional?(this.timeoutStore.remove("dragDelay"),t.active=!1,void this.startPointerDrag(e)):n.preventScrollAxis&&!t._preventScroll?t.axis?t.axis===n.preventScrollAxis||"xy"===n.preventScrollAxis?(t._active=!1,void this.clean()):(this.timeoutStore.remove("startPointerDrag"),void this.startPointerDrag(e)):void 0:void this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(e){}const t=this.state,n=this.config;if(!t._active||!t._pointerActive)return;const i=x(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[r,o]=t._distance;if(t.tap=r<=n.tapsThreshold&&o<=n.tapsThreshold,t.tap&&n.filterTaps)t._force=!0;else{const[e,i]=t._delta,[r,o]=t._movement,[s,a]=n.swipe.velocity,[d,c]=n.swipe.distance,u=n.swipe.duration;if(t.elapsedTime<u){const n=Math.abs(e/t.timeDelta),u=Math.abs(i/t.timeDelta);n>s&&Math.abs(r)>d&&(t.swipe[0]=Math.sign(e)),u>a&&Math.abs(o)>c&&(t.swipe[1]=Math.sign(i))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const t=this.config,n=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,n,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,n,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,function(e){"persist"in e&&"function"==typeof e.persist&&e.persist()}(e);const t=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",t),this.eventStore.add(this.sharedConfig.window,"touch","cancel",t),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",(()=>{this.state._step=[0,0],this.startPointerDrag(e)}),this.config.delay)}keyDown(e){const t=E[e.key];if(t){const n=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),n._delta=t(this.config.keyboardDisplacement,i),n._keyboardActive=!0,r.addTo(n._movement,n._delta),this.compute(e),this.emit()}}keyUp(e){e.key in E&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}},resolver:L};const U={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=(O.isBrowser?window:void 0))=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},z=["target","eventOptions","window","enabled","transform"];function X(e={},t){const n={};for(const[i,r]of Object.entries(t))switch(typeof r){case"function":n[i]=r.call(n,e[i],i,e);break;case"object":n[i]=X(e[i],r);break;case"boolean":r&&(n[i]=e[i])}return n}class F{constructor(e,t){a(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,i,r){const o=this._listeners,s=function(e,t=""){const n=u[e];return e+(n&&n[t]||t)}(t,n),a=c(c({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),r);e.addEventListener(s,i,a);const d=()=>{e.removeEventListener(s,i,a),o.delete(d)};return o.add(d),d}clean(){this._listeners.forEach((e=>e())),this._listeners.clear()}}class Y{constructor(){a(this,"_timeouts",new Map)}add(e,t,n=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach((e=>{window.clearTimeout(e)})),this._timeouts.clear()}}class N{constructor(e){var t,n;a(this,"gestures",new Set),a(this,"_targetEventStore",new F(this)),a(this,"gestureEventStores",{}),a(this,"gestureTimeoutStores",{}),a(this,"handlers",{}),a(this,"config",{}),a(this,"pointerIds",new Set),a(this,"touchIds",new Set),a(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),t=this,(n=e).drag&&K(t,"drag"),n.wheel&&K(t,"wheel"),n.scroll&&K(t,"scroll"),n.move&&K(t,"move"),n.pinch&&K(t,"pinch"),n.hover&&K(t,"hover")}setEventIds(e){return f(e)?(this.touchIds=new Set(function(e){return function(e){return Array.from(e.touches).filter((t=>{var n,i;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(i=n.contains)||void 0===i?void 0:i.call(n,t.target))}))}(e).map((e=>e.identifier))}(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,n={}){const i=e,{target:r,eventOptions:o,window:s,enabled:a,transform:d}=i,u=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(i,z);if(n.shared=X({target:r,eventOptions:o,window:s,enabled:a,transform:d},U),t){const e=B.get(t);n[t]=X(c({shared:n.shared},u),e)}else for(const e in u){const t=B.get(e);t&&(n[e]=X(c({shared:n.shared},u[e]),t))}return n}(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,n={};let i;if(!t.target||(i=t.target(),i)){if(t.enabled){for(const t of this.gestures){const r=this.config[t],o=V(n,r.eventOptions,!!i);r.enabled&&new(D.get(t))(this,e,t).bind(o)}const r=V(n,t.eventOptions,!!i);for(const t in this.nativeHandlers)r(t,"",(n=>this.nativeHandlers[t](c(c({},this.state.shared),{},{event:n,args:e}))),void 0,!0)}for(const e in n)n[e]=w(...n[e]);if(!i)return n;for(const e in n){const{device:t,capture:r,passive:o}=b(e);this._targetEventStore.add(i,t,"",n[e],{capture:r,passive:o})}}}}function K(e,t){e.gestures.add(t),e.gestureEventStores[t]=new F(e,t),e.gestureTimeoutStores[t]=new Y}const V=(e,t,n)=>(i,r,o,s={},a=!1)=>{var d,c;const h=null!==(d=s.capture)&&void 0!==d?d:t.capture,b=null!==(c=s.passive)&&void 0!==c?c:t.passive;let f=a?i:function(e,t="",n=!1){const i=u[e],r=i&&i[t]||t;return"on"+g(e)+g(r)+(function(e=!1,t){return e&&!l.includes(t)}(n,r)?"Capture":"")}(i,r,h);n&&b&&(f+="Passive"),e[f]=e[f]||[],e[f].push(o)};function G(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){G(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class W{constructor(e,t,n,i,r){this._target=e,this._gestureKey=i,this._ctrl=new N(t),this._ctrl.applyHandlers(t,r),this._ctrl.applyConfig(q(q({},n),{},{target:e}),i),this._ctrl.effect()}destroy(){this._ctrl.clean()}setConfig(e){this._ctrl.clean(),this._ctrl.applyConfig(q(q({},e),{},{target:this._target}),this._gestureKey),this._ctrl.effect()}}const J=function(e,t,n){var i;return i=j,D.set(i.key,i.engine),B.set(i.key,i.resolver),new W(e,{drag:t},n||{},"drag")};class Z{constructor(){this._bottomLeft={x:0,y:0},this._topRight={x:0,y:0}}get top(){return this._topRight.y}get bottom(){return this._bottomLeft.y}get left(){return this._bottomLeft.x}get right(){return this._topRight.x}get topLeft(){return{x:this.left,y:this.top}}get topRight(){return{...this._topRight}}get bottomLeft(){return{...this._bottomLeft}}get bottomRight(){return{x:this.right,y:this.bottom}}get width(){return this._topRight.x-this._bottomLeft.x}get height(){return this.topRight.y-this._bottomLeft.y}get centreX(){return this.left+this.width/2}get centreY(){return this.bottom+this.height/2}set(e,t){this._bottomLeft.x=e.x,this._bottomLeft.y=e.y,this._topRight.x=t.x,this._topRight.y=t.y}adjustAspectRatio(e,t){if(e>=t){const n=(e/t*this.height-this.width)/2;this._bottomLeft.x-=n,this._topRight.x+=n}if(e<t){const n=(t/e*this.width-this.height)/2;this._bottomLeft.y-=n,this._topRight.y+=n}}mouseToRegion(e,t,n){const i=t*(this.width/e.width),r=n*(this.height/e.height);return{regionMouseX:this.left+i,regionMouseY:this.bottom+r}}drag(e,t,n){const i=t*(this.width/e.width),r=n*(this.height/e.height);this._bottomLeft.x-=i,this._bottomLeft.y-=r,this._topRight.x-=i,this._topRight.y-=r}recentre(e,t){const n=e-this.centreX,i=t-this.centreY;this._bottomLeft.x+=n,this._bottomLeft.y+=i,this._topRight.x+=n,this._topRight.y+=i}panX(e){const t=this.width/100*e;this._bottomLeft.x-=t,this._topRight.x-=t}panY(e){const t=this.height/100*e;this._bottomLeft.y-=t,this._topRight.y-=t}zoom(e){const t=this.width/100*e/2,n=this.height/100*e/2;this._bottomLeft.x+=t,this._bottomLeft.y+=n,this._topRight.x-=t,this._topRight.y-=n}}const Q=(e,t)=>Math.random()*(t-e)+e,ee=(e,t)=>Math.floor(Q(e,t)),te=e=>e[ee(0,e.length)],ne=()=>Q(-.1,.1),ie=()=>Q(.01,1),re=(e,t,n)=>{t.width=n,t.height=n;const i=t.getContext("2d"),r=new ImageData(e,n,n);i.putImageData(r,0,0),i.scale(1,-1),i.translate(0,-n),i.drawImage(t,0,0)},oe=["jet","hsv","hot","cool","warm","spring","summer","autumn","winter","bone","copper","greys","YIOrRd","bluered","RdBu","picnic","rainbow","portland","blackbody","earth","electric","viridis","inferno","magma","plasma","rainbow-soft","bathymetry","cdom","chlorophyll","density","freesurface-blue"],se={fractalSetId:0,juliaConstant:{x:0,y:0},colourMapId:0,regionBottomLeft:{x:-.22,y:-.7},regionTopRight:{x:-.21,y:-.69},maxIterations:128},ae={fractalSetId:0,juliaConstant:{x:0,y:0},colourMapId:0,regionBottomLeft:{x:-2.25,y:-1.5},regionTopRight:{x:.75,y:1.5},maxIterations:128},de=64;let ce,ue,ge,le,he,be,fe,me=!1;const pe=new Map,xe=new Map;let ve,ye,_e,we,Te,Se=128;const Me=new Z;let Re,ke,Ie,Ee,Ae=0,Ce=0,Oe=0,Pe=!1,Le=!1,De=!1,Be=new Map,je=0,Ue=!1,ze=!1,Xe=!0,Fe=0;const Ye=()=>{Ue=!0},Ne=()=>{Ue=!1},Ke=e=>{localStorage.bookmarks=JSON.stringify(Array.from(e.entries()))},$e=e=>{e.id=je++,Be.set(e.id,e),Ke(Be)},Ve=e=>{Be.set(e.id,e),Ke(Be)},Ge=e=>{Be.delete(e.id),Ke(Be)},He=e=>({name:e||`Bookmark${je}`,fractalSetId:ve,juliaConstant:{..._e},colourMapId:we,regionBottomLeft:{...Me.bottomLeft},regionTopRight:{...Me.topRight},maxIterations:Se}),qe=e=>{tt(e)},We="webgl",Je="webgl2",Ze=["experimental-webgl",We,Je],Qe=(e,t,n,i)=>{const r=((e,t)=>{if(t?.length>0){const n=e.indexOf("// INSERT-COMMON-CODE-HERE\n");if(n>=0){const i=n+27,r=t.join("\n");return e.substring(0,i)+r+e.substring(i)}}return e})(t,i),o=e.createShader(n);if(e.shaderSource(o,r),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){const t=e.getShaderInfoLog(o);return console.error(`Failed to compile shader: ${t}`),null}return o},et=(e,t,n)=>{const i=me?["const int COLOUR_MAP_SIZE = 256;\n\nuniform int uSmoothColouring;\nuniform int uReturnIteration;\n\nvec4 loop(int maxIterations, sampler2D colourMap, vec2 z, vec2 c) {\n  int iteration = 0;\n  while (iteration < maxIterations) {\n    if (dot(z, z) >= 4.0) break;\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n    iteration++;\n  }\n\n  if (uReturnIteration > 0) {\n    int hi = (iteration & 0xff00) >> 8;\n    int lo = iteration & 0xff;\n    float hif = float(hi) / 255.0;\n    float lof = float(lo) / 255.0;\n    return vec4(lof, hif, 0.0, 1.0);\n  } else {\n    float possiblySmoothedIteration = uSmoothColouring > 0\n      ? float(iteration) - clamp(log(log(length(z))) / log(2.0), -1.0, 1.0)\n      : float(iteration);\n\n    float s = possiblySmoothedIteration / float(maxIterations);\n    float t = 0.5;\n    vec2 textureCoords = vec2(s, t);\n    return texture(colourMap, textureCoords);\n  }\n}\n"]:["// Same value as INITIAL_ITERATIONS in constants.js\nconst int MAX_ITERATIONS = 128;\n\nconst int COLOUR_MAP_SIZE = 256;\n\nuniform int uSmoothColouring;\nuniform int uReturnIteration;\n\nvec4 loop(sampler2D colourMap, vec2 z, vec2 c) {\n  int iteration = MAX_ITERATIONS;\n  for (int i = 0; i < MAX_ITERATIONS; i++) {\n    if (dot(z, z) >= 4.0) {\n      iteration = i;\n      break;\n    }\n    vec2 zSquared = vec2(z.x * z.x - z.y * z.y, 2.0 * z.x * z.y);\n    z = zSquared + c;\n  }\n\n  if (uReturnIteration > 0) {\n    int hi = (iteration & 0xff00) >> 8;\n    int lo = iteration & 0xff;\n    float hif = float(hi) / 255.0;\n    float lof = float(lo) / 255.0;\n    return vec4(lof, hif, 0.0, 1.0);\n  } else {\n    // http://linas.org/art-gallery/escape/escape.html\n    float possiblySmoothedIteration = uSmoothColouring > 0\n      ? float(iteration) - clamp(log(log(length(z))) / log(2.0), -1.0, 1.0)\n      : float(iteration);\n\n    float s = possiblySmoothedIteration / float(MAX_ITERATIONS);\n    float t = 0.5;\n    vec2 textureCoords = vec2(s, t);\n    return texture2D(colourMap, textureCoords);\n  }\n}\n"],r=Qe(be,t,be.VERTEX_SHADER),o=Qe(be,n,be.FRAGMENT_SHADER,i),s=be.createProgram();if(be.attachShader(s,r),be.attachShader(s,o),be.linkProgram(s),!be.getProgramParameter(s,be.LINK_STATUS)){const e=be.getProgramInfoLog(s);return void console.error(`Failed to link program: ${e}`)}if(be.validateProgram(s),!be.getProgramParameter(s,be.VALIDATE_STATUS)){const e=be.getProgramInfoLog(s);return void console.error(`Failed to validate program: ${e}`)}const a=be.getAttribLocation(s,"aVertexPosition");be.enableVertexAttribArray(a);const d=be.getAttribLocation(s,"aRegionPosition");be.enableVertexAttribArray(d);const c=be.createBuffer();be.bindBuffer(be.ARRAY_BUFFER,c),be.bufferData(be.ARRAY_BUFFER,32,be.DYNAMIC_DRAW);const u=be.getUniformLocation(s,"uModelViewMatrix"),g=be.getUniformLocation(s,"uColourMap"),l=be.getUniformLocation(s,"uJuliaConstant"),h=be.getUniformLocation(s,"uSmoothColouring"),b=be.getUniformLocation(s,"uReturnIteration"),f=me?{uMaxIterations:be.getUniformLocation(s,"uMaxIterations")}:void 0,m=new Float32Array([1,1,-1,1,1,-1,-1,-1]),p=be.createBuffer();return be.bindBuffer(be.ARRAY_BUFFER,p),be.bufferData(be.ARRAY_BUFFER,m,be.STATIC_DRAW),be.vertexAttribPointer(a,2,be.FLOAT,!1,0,0),{name:e,program:s,aVertexPosition:a,aRegionPosition:d,uModelViewMatrix:u,...f,uColourMap:g,uJuliaConstant:l,uSmoothColouring:h,uReturnIteration:b,vertexPositionBuffer:p,regionPositionBuffer:c}},tt=({fractalSetId:e,juliaConstant:t,colourMapId:n,maxIterations:r,regionBottomLeft:o,regionTopRight:s})=>{o&&s&&nt((()=>{Me.set(o,s)})),Number.isInteger(e)&&(ve=e,ye=pe.get(e)),t&&(_e=t),Number.isInteger(n)&&(we=n,Te=xe.get(n)),me&&Number.isInteger(r)&&(Se=r),be.useProgram(ye.program);const a=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}((d=new i(16),i!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[11]=0,d[12]=0,d[13]=0,d[14]=0),d[0]=1,d[5]=1,d[10]=1,d[15]=1,d),[1,-1,1]);var d;be.uniformMatrix4fv(ye.uModelViewMatrix,!1,a),be.uniform1i(ye.uColourMap,Te.textureUnit),be.uniform2f(ye.uJuliaConstant,_e.x,_e.y),be.uniform1i(ye.uSmoothColouring,Xe),be.uniform1i(ye.uReturnIteration,!1),me&&be.uniform1i(ye.uMaxIterations,Se)},nt=e=>{e(),(()=>{if(!ye)return;const{regionPositionBuffer:e,aRegionPosition:t}=ye,n=new Float32Array([Me.topRight.x,Me.topRight.y,Me.topLeft.x,Me.topLeft.y,Me.bottomRight.x,Me.bottomRight.y,Me.bottomLeft.x,Me.bottomLeft.y]);be.bindBuffer(be.ARRAY_BUFFER,e),be.bufferData(be.ARRAY_BUFFER,n,be.DYNAMIC_DRAW),be.vertexAttribPointer(t,2,be.FLOAT,!1,0,0),be.bindBuffer(be.ARRAY_BUFFER,null)})()},it=(e=!1)=>{e&&be.uniform1i(ye.uReturnIteration,!0),be.drawArrays(be.TRIANGLE_STRIP,0,4),e&&be.uniform1i(ye.uReturnIteration,!1),ce.manualMode&&bt()},rt=async e=>{const t=e??Ee;t&&(e||(console.log("[displayConfiguration]","nextConfigurationCount:",Fe),Ee=void 0,Fe=0),qe(t),ot(),bt(t),Ae=t.panSpeedX??ne(),Ce=t.panSpeedY??ne(),Oe=t.zoomSpeed??ie()),setTimeout(rt,1e4)},ot=(e,t)=>{const n=e??ue.clientWidth,i=t??ue.clientHeight;e||t||(ue.width=n,ue.height=i,ge.setSize(n,i)),be.viewport(0,0,n,i),nt((()=>{Me.adjustAspectRatio(n,i)}))},st=()=>{ot(),it()},at=e=>{const t=e.offsetX,n=e.offsetY,{regionMouseX:i,regionMouseY:r}=Me.mouseToRegion(ue,t,n);if(e.metaKey)return Le=!0,Re={mouseX:t,mouseY:n},void(ke={mouseX:t,mouseY:n});if(e.shiftKey)return nt((()=>{Me.recentre(i,r)})),it();if(e.altKey)switch(ve){case 0:return tt({fractalSetId:1,juliaConstant:{x:i,y:r}}),void it();case 1:return tt({fractalSetId:0}),void it();default:return}Pe=!0,Ie={mouseX:t,mouseY:n}},dt=e=>{const t=e.offsetX,n=e.offsetY;return Pe?(nt((()=>{const e=t-Ie.mouseX,i=n-Ie.mouseY;Me.drag(ue,e,i)})),it(),void(Ie={mouseX:t,mouseY:n})):Le?(ke={mouseX:t,mouseY:n},void ge.drawSelectionRegion(Re.mouseX,Re.mouseY,ke.mouseX,ke.mouseY)):void 0},ct=()=>{if(Pe=!1,Le){const e=Re,t=ke,n=Math.max(e.mouseY,t.mouseY),i=Math.min(e.mouseY,t.mouseY),r=Math.min(e.mouseX,t.mouseX),o=Math.max(e.mouseX,t.mouseX),s=Me.mouseToRegion(ue,r,i),a=Me.mouseToRegion(ue,o,n),d={x:s.regionMouseX,y:s.regionMouseY},c={x:a.regionMouseX,y:a.regionMouseY};nt((()=>{Me.set(d,c)})),ot(),it(),ge.clearSelectionRegion(),Le=!1}},ut=()=>{Pe&&(Pe=!1),Le&&(ge.clearSelectionRegion(),Re=void 0,ke=void 0,Le=!1)},gt=e=>{if(!Ue){if(De)return ft(e);if(De||"b"!==e.key||!e.ctrlKey){if("+"===e.key)return nt((()=>{Me.zoom(50)})),void it();if("-"===e.key)return nt((()=>{Me.zoom(-100)})),void it();if("h"===e.key)return qe(ae),ot(),void it();if("c"===e.key||"C"===e.key){const t=Array.from(xe.keys()),n=t.length,i=t.indexOf(we),r=t[(i+(e.shiftKey?n-1:1))%n];return tt({colourMapId:r}),void it()}if(me&&("i"===e.key||"I"===e.key)){const n=16*(e.shiftKey?-1:1);return 16,4096,t=Se+n,Se=Math.max(16,Math.min(4096,t)),tt({maxIterations:Se}),void it()}var t;"s"===e.key&&(Xe=!Xe,tt({}),it()),"v"===e.key&&(ze?lt():ht())}else De=!0}},lt=()=>{ge.hideConfigurationSummary(),ze=!1},ht=()=>{const e=He();ge.showConfigurationSummary(e),ze=!0},bt=()=>{const e=He();ge.updateConfigurationSummary(e)},ft=e=>{if(De=!1,"n"===e.key){const e=He();return fe.presentBookmarkModal(e)}if("l"===e.key)return fe.presentManageBookmarksModal(Be)},mt=new URL(document.location);var pt;(async e=>{ce=e,ue=document.getElementById("canvas"),(e=>{const t=t=>{try{be=e.getContext(t),be||console.log(`Failed to initialise WebGL (contextType: ${t})`)}catch(e){alert(`Exception trying to initialise WebGL (contextType: ${t})\n${e.message}`)}const n=Boolean(be);return n&&t===Je&&(me=!0),n},n=Ze.includes(ce.contextType)?ce.contextType:Je;t(n)||n!==We&&t(We)})(ue),(()=>{const e=me?"#version 300 es\nprecision highp float;\n\nin vec2 aVertexPosition;\nin vec2 aRegionPosition;\nuniform mat4 uModelViewMatrix;\nout vec2 vRegionPosition;\n\nvoid main(void) {\n  gl_Position = uModelViewMatrix * vec4(aVertexPosition, 0, 1);\n  vRegionPosition = aRegionPosition;\n}\n":"precision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aRegionPosition;\nuniform mat4 uModelViewMatrix;\nvarying vec2 vRegionPosition;\n\nvoid main(void) {\n  gl_Position = uModelViewMatrix * vec4(aVertexPosition, 0, 1);\n  vRegionPosition = aRegionPosition;\n}\n",t=me?"#version 300 es\nprecision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform int uMaxIterations;\nuniform sampler2D uColourMap;\nuniform vec2 uJuliaConstant;\nin vec2 vRegionPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 z = vRegionPosition;\n  vec2 c = uJuliaConstant;\n  fragColor = loop(uMaxIterations, uColourMap, z, c);\n}\n":"precision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform sampler2D uColourMap;\nuniform vec2 uJuliaConstant;\nvarying vec2 vRegionPosition;\n\nvoid main(void) {\n  vec2 z = vRegionPosition;\n  vec2 c = uJuliaConstant;\n  gl_FragColor = loop(uColourMap, z, c);\n}\n",n=et("Mandelbrot",e,me?"#version 300 es\nprecision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform int uMaxIterations;\nuniform sampler2D uColourMap;\nin vec2 vRegionPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 z;\n  vec2 c = vRegionPosition;\n  fragColor = loop(uMaxIterations, uColourMap, z, c);\n}\n":"precision highp float;\n\n// INSERT-COMMON-CODE-HERE\n\nuniform sampler2D uColourMap;\nvarying vec2 vRegionPosition;\n\nvoid main(void) {\n  vec2 z;\n  vec2 c = vRegionPosition;\n  gl_FragColor = loop(uColourMap, z, c);\n}\n"),i=et("Julia",e,t);pe.set(0,n),pe.set(1,i)})(),oe.forEach(((e,n)=>{xe.set(n,((e,n)=>{const i=t()({colormap:e,nshades:256,format:"float"}).flat();return((e,t)=>{const n=be.createTexture();be.activeTexture(be.TEXTURE0+t),be.bindTexture(be.TEXTURE_2D,n),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_S,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_T,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MIN_FILTER,be.LINEAR),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MAG_FILTER,be.LINEAR);const i=new Uint8Array(e.map((e=>255*e))),r=e.length/4;be.texImage2D(be.TEXTURE_2D,0,be.RGBA,r,1,0,be.RGBA,be.UNSIGNED_BYTE,i)})(i,n),{name:e,colourMap:i,textureUnit:n}})(e,n))})),ge=(({fractalSets:e,colourMaps:t})=>{const n=document.getElementById("canvasOverlay"),i=n.getContext("2d"),r=document.getElementById("divOverlay"),o=document.getElementById("configurationSummary");let s,a=!1;const d=()=>{i.clearRect(0,0,n.width,n.height)},c=({x:e,y:t})=>`(${e}, ${t})`,u=n=>{const i=1===n.fractalSetId?c(n.juliaConstant):"",r=`${c(n.regionBottomLeft)}, ${c(n.regionTopRight)}`,s=[e.get(n.fractalSetId)?.name??"unknown",i,r,t.get(n.colourMapId)?.name??"unknown",n.maxIterations];o.innerText=s.filter(Boolean).join(" | ")},g=()=>{o.style.display="block"},l=()=>{o.style.display="none"},h=()=>{clearTimeout(s),s=void 0};return{setSize:(e,t)=>{n.width=e,n.height=t,r.width=e,r.height=t},drawSelectionRegion:(e,t,n,r)=>{d();const o=Math.max(t,r),s=Math.min(t,r),a=Math.min(e,n),c=Math.max(e,n)-a,u=o-s;i.lineWidth=2,i.strokeStyle="#FFFFFF80",i.strokeRect(a,s,c,u)},clearSelectionRegion:d,showConfigurationSummary:e=>{u(e),g(),h(),a=!0},hideConfigurationSummary:()=>{l(),h(),a=!1},updateConfigurationSummary:e=>{u(e),a||(g(),h(),s=setTimeout((()=>{l(),s=void 0}),5e3))}}})({fractalSets:pe,colourMaps:xe}),le=(({gl:e,createBookmark:t,switchToBookmark:n,setCanvasAndViewportSize:i,render:r})=>({renderThumbnail:(o,s,a)=>{const d=e.createTexture();e.activeTexture(e.TEXTURE0+oe.length),e.bindTexture(e.TEXTURE_2D,d),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,o,o,0,e.RGBA,e.UNSIGNED_BYTE,null);const c=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,c),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,d,0);const u=t("saved-configuration");n(s),i(o,o),r(a);const g=new Uint8ClampedArray(o*o*4);return e.readPixels(0,0,o,o,e.RGBA,e.UNSIGNED_BYTE,g),n(u),i(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(c),e.bindTexture(e.TEXTURE_2D,null),e.deleteTexture(d),g}}))({gl:be,createBookmark:He,switchToBookmark:qe,setCanvasAndViewportSize:ot,render:it});const n=Array.from(pe.keys()),i=Array.from(xe.keys());if(he=(({renderThumbnail:e,fractalSetIds:t,colourMapIds:n,preview:i})=>{const r=document.getElementById("preview-initial"),o=document.getElementById("preview-final"),s=(t,n)=>{const i=e(64,t,!0),r=new Set;for(let e=0;e<i.length;e+=4){const t=i[e]+(i[e+1]<<8);r.add(t)}const o=Array.from(r).length,s=t.maxIterations,a=.6*s,d=o>=a;if(d){const e={type:n,numUniqueIterationValues:o,threshold:a,maxIterations:s};console.log("[configureConfigurationChooser]",JSON.stringify(e,null,2))}return d};return{chooseConfiguration:a=>{const d=(()=>{const e=te(t),i=te(n),r=Q(-2,.75),o=Q(-1.5,1.5),s=Q(.01,.5);return{fractalSetId:e,juliaConstant:{x:r,y:o},colourMapId:i,regionBottomLeft:{x:r-s,y:o-s},regionTopRight:{x:r+s,y:o+s},maxIterations:ee(32,1024),panSpeedX:ne(),panSpeedY:ne(),zoomSpeed:ie()}})();if(s(d,"initial")){const t=((e,t)=>{const n=60*t,i=new Z;i.set(e.regionBottomLeft,e.regionTopRight);for(let t=0;t<n;t++)i.panX(e.panSpeedX),i.panY(e.panSpeedY),i.zoom(e.zoomSpeed);return{...e,regionBottomLeft:i.bottomLeft,regionTopRight:i.topRight}})(d,a);if(s(t,"final")){if(i){const n=e(64,d),i=e(64,t);re(n,r,64),re(i,o,64)}return d}}}}})({renderThumbnail:le.renderThumbnail,fractalSetIds:n,colourMapIds:i,preview:ce.preview}),fe=(({isWebGL2:e,renderThumbnail:t,addBookmark:n,updateBookmark:i,deleteBookmark:r,switchToBookmark:o,fractalSets:s,colourMaps:a,onModalOpen:d,onModalClose:c})=>{const u=r=>{console.log("[presentBookmarkModal]","bookmark:",r);const o=$("#bookmarkModal").on("show.bs.modal",d).on("hide.bs.modal",c),u=Number.isInteger(r.id),g=u?"Edit Bookmark":"Create Bookmark";$(".modal-title",o).text(g),$('input[type="submit"]',o).off("click").on("click",(e=>{e.preventDefault(),r.name=$("#name",o).val(),u?i(r):n(r),o.modal("hide")}));const l=$("#thumbnail-canvas",o).get(0),h=t(de,r);re(h,l,de),$("#name",o).val(r.name).focus(),$(".fractal-set",o).text(s.get(r.fractalSetId).name);const b=$("#colour-map-select",o).empty();for(const[e,t]of a){const n=e===r.colourMapId?"selected":"";b.append(`<option value="${e}" ${n}>${t.name}</option>`)}b.on("change",(e=>{r.colourMapId=Number(e.target.value);const n=t(de,r);re(n,l,de)}));const f=$("#max-iterations",o);f.text(r.maxIterations);const m=$("#max-iterations-range",o);e?(m.attr("min",16).attr("max",4096).attr("step",16).val(r.maxIterations),m.on("input",(e=>{r.maxIterations=Number(e.target.value),f.text(r.maxIterations);const n=t(de,r);re(n,l,de)}))):m.hide(),$(".region-bottom-left",o).text(`(${r.regionBottomLeft.x}, ${r.regionBottomLeft.y})`),$(".region-top-right",o).text(`(${r.regionTopRight.x}, ${r.regionTopRight.y})`);const p=$(".julia-constant",o),x=p.closest("div");1===r.fractalSetId?(p.text(`(${r.juliaConstant.x}, ${r.juliaConstant.y})`),x.show()):x.hide(),o.modal()};return{presentBookmarkModal:u,presentManageBookmarksModal:e=>{console.log("[presentManageBookmarksModal]","bookmarks:",e);const n=$("#manageBookmarksModal").on("show.bs.modal",d).on("hide.bs.modal",c),i=$("tbody",n).empty(),s=(e,t)=>()=>{n.modal("hide"),e(t)},a=e=>o(e),g=e=>{const t={...e};u(t)},l=e=>{r(e)},h=document.getElementById("bookmark-row-template");e.forEach((e=>{const n=document.importNode(h.content,!0),r=n.querySelector(":nth-child(2)"),o=n.querySelector(":nth-child(3) i"),d=n.querySelector(":nth-child(4) i"),c=n.querySelector(":nth-child(1) canvas"),u=t(de,e);re(u,c,de),r.innerText=e.name,c.addEventListener("click",s(a,e)),o.addEventListener("click",s(g,e)),d.addEventListener("click",s(l,e)),i.append(n)})),n.modal()}}})({isWebGL2:me,renderThumbnail:le.renderThumbnail,addBookmark:$e,updateBookmark:Ve,deleteBookmark:Ge,switchToBookmark:e=>{qe(e),ot(),it()},fractalSets:pe,colourMaps:xe,onModalOpen:Ye,onModalClose:Ne}),window.addEventListener("resize",st),ce.manualMode)ue.addEventListener("mousedown",at),ue.addEventListener("mousemove",dt),ue.addEventListener("mouseup",ct),ue.addEventListener("mouseleave",ut),document.addEventListener("keydown",gt),new J(ue,(e=>{if(!e.metaKey)if(e.active)if(Pe)nt((()=>{const[t,n]=e.values,i=t-Ie.mouseX,r=n-Ie.mouseY;Me.drag(ue,i,r),Ie={mouseX:t,mouseY:n}})),it();else{Pe=!0;const[t,n]=e.initial;Ie={mouseX:t,mouseY:n}}else Pe=!1})),(e=>{const t=JSON.parse(localStorage.bookmarks||"[]");for(const[n,i]of t){const{thumbnail:t,...r}=i;e.set(n,r)}})(Be),je=Be.size?Math.max(...Be.keys())+1:0,qe(se),ot(),it();else{rt(se);const e=()=>{nt((()=>{Me.panX(Ae),Me.panY(Ce),Me.zoom(Oe)})),it(),requestAnimationFrame(e),Ee||(Ee=he.chooseConfiguration(10),Fe++)};e()}})({manualMode:"manual"===mt.searchParams.get("mode"),contextType:mt.searchParams.get("contextType"),preview:(pt=mt.searchParams.get("preview"),["","true","1","on"].includes(pt?.toLowerCase()))})})()})();
//# sourceMappingURL=bundle.js.map